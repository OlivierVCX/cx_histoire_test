!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).adblocker={})}(this,(function(e){"use strict";function t(e){return e.every((e=>"string"!=typeof e))}function n(e){return e.every((e=>"comma"!==e.type&&"combinator"!==e.type))}const o=new Set(["any","dir","has","host-context","is","matches","not","where"]),r={attribute:/\[\s*(?:(?<namespace>\*|[-\w]*)\|)?(?<name>[-\w\u{0080}-\u{FFFF}]+)\s*(?:(?<operator>\W?=)\s*(?<value>.+?)\s*(?<caseSensitive>[iIsS])?\s*)?\]/gu,id:/#(?<name>(?:[-\w\u{0080}-\u{FFFF}]|\\.)+)/gu,class:/\.(?<name>(?:[-\w\u{0080}-\u{FFFF}]|\\.)+)/gu,comma:/\s*,\s*/g,combinator:/\s*[\s>+~]\s*/g,"pseudo-element":/::(?<name>[-\w\u{0080}-\u{FFFF}]+)(?:\((?:¶*)\))?/gu,"pseudo-class":/:(?<name>[-\w\u{0080}-\u{FFFF}]+)(?:\((?<argument>¶*)\))?/gu,type:/(?:(?<namespace>\*|[-\w]*)\|)?(?<name>[-\w\u{0080}-\u{FFFF}]+)|\*/gu},s=new Set(["pseudo-class","pseudo-element"]),i=new Set([...s,"attribute"]),c=new Set(["combinator","comma"]),u=Object.assign({},r);function l(e,t){e.lastIndex=0;const n=e.exec(t);if(null===n)return;const o=n.index-1,r=n[0],s=t.slice(0,o+1),i=t.slice(o+r.length+1);return[s,[r,n.groups||{}],i]}u["pseudo-element"]=RegExp(r["pseudo-element"].source.replace("(?<argument>¶*)","(?<argument>.*?)"),"gu"),u["pseudo-class"]=RegExp(r["pseudo-class"].source.replace("(?<argument>¶*)","(?<argument>.*)"),"gu");const a=[e=>{const t=l(r.attribute,e);if(void 0===t)return;const[n,[o,{name:s,operator:i,value:c,namespace:u,caseSensitive:a}],f]=t;return void 0!==s?[n,{type:"attribute",content:o,length:o.length,namespace:u,caseSensitive:a,pos:[],name:s,operator:i,value:c},f]:void 0},e=>{const t=l(r.id,e);if(void 0===t)return;const[n,[o,{name:s}],i]=t;return void 0!==s?[n,{type:"id",content:o,length:o.length,pos:[],name:s},i]:void 0},e=>{const t=l(r.class,e);if(void 0===t)return;const[n,[o,{name:s}],i]=t;return void 0!==s?[n,{type:"class",content:o,length:o.length,pos:[],name:s},i]:void 0},e=>{const t=l(r.comma,e);if(void 0===t)return;const[n,[o],s]=t;return[n,{type:"comma",content:o,length:o.length,pos:[]},s]},e=>{const t=l(r.combinator,e);if(void 0===t)return;const[n,[o],s]=t;return[n,{type:"combinator",content:o,length:o.length,pos:[]},s]},e=>{const t=l(r["pseudo-element"],e);if(void 0===t)return;const[n,[o,{name:s}],i]=t;return void 0!==s?[n,{type:"pseudo-element",content:o,length:o.length,pos:[],name:s},i]:void 0},e=>{const t=l(r["pseudo-class"],e);if(void 0===t)return;const[n,[o,{name:s,argument:i}],c]=t;return void 0!==s?[n,{type:"pseudo-class",content:o,length:o.length,pos:[],name:s,argument:i,subtree:void 0},c]:void 0},e=>{const t=l(r.type,e);if(void 0===t)return;const[n,[o,{name:s,namespace:i}],c]=t;return[n,{type:"type",content:o,length:o.length,namespace:i,pos:[],name:s},c]}];function f(e,t,n,o){for(const r of t)for(const t of e)if(o.has(t.type)&&t.pos[0]<r.start&&r.start<t.pos[1]){const e=t.content;if(t.content=t.content.replace(n,r.str),t.content!==e){u[t.type].lastIndex=0;const e=u[t.type].exec(t.content);null!==e&&Object.assign(t,e.groups)}}}function d(e,t){let n=0;for(t-=1;t>=0&&"\\"===e[t];)n+=1,t-=1;return n%2!=0}function p(e,t,n){let o=n+1;for(;-1!==(o=e.indexOf(t,o))&&!0===d(e,o);)o+=1;if(-1!==o)return e.slice(n,o+1)}function m(e,t){let n=0;for(let o=t;o<e.length;o++){const r=e[o];if("("===r)n+=1;else if(")"===r){if(!(n>0))return;n-=1}if(0===n)return e.slice(t,o+1)}}function h(e,t,n,o){const r=[];let s=0;for(;-1!==(s=e.indexOf(n,s));){const n=o(e,s);if(void 0===n)break;r.push({str:n,start:s}),e=`${e.slice(0,s+1)}${t.repeat(n.length-2)}${e.slice(s+n.length-1)}`,s+=n.length}return[r,e]}function g(e){if("string"!=typeof e)return[];if(0===(e=e.trim()).length)return[];const[n,o]=h(e,"§",'"',((e,t)=>p(e,'"',t))),[r,u]=h(o,"§","'",((e,t)=>p(e,"'",t))),[l,d]=h(u,"¶","(",m),g=function(e){if(!e)return[];const n=[e];for(const e of a)for(let t=0;t<n.length;t++){const o=n[t];if("string"==typeof o){const r=e(o);void 0!==r&&n.splice(t,1,...r.filter((e=>0!==e.length)))}}let o=0;for(const e of n)"string"!=typeof e&&(e.pos=[o,o+e.length],c.has(e.type)&&(e.content=e.content.trim()||" ")),o+=e.length;return t(n)?n:[]}(d);return f(g,l,/\(¶*\)/,s),f(g,n,/"§*"/,i),f(g,r,/'§*'/,i),g}function y(e,{list:t=!0}={}){if(!0===t&&e.some((e=>"comma"===e.type))){const t=[],n=[];for(let o=0;o<e.length;o+=1){const r=e[o];if("comma"===r.type){if(0===n.length)throw new Error("Incorrect comma at "+o);const e=y(n,{list:!1});void 0!==e&&t.push(e),n.length=0}else n.push(r)}if(0===n.length)throw new Error("Trailing comma");{const e=y(n,{list:!1});void 0!==e&&t.push(e)}return{type:"list",list:t}}for(let t=e.length-1;t>=0;t--){const n=e[t];if("combinator"===n.type){const o=y(e.slice(0,t)),r=y(e.slice(t+1));if(void 0===r)return;if(" "!==n.content&&"~"!==n.content&&"+"!==n.content&&">"!==n.content)return;return{type:"complex",combinator:n.content,left:o,right:r}}}if(0!==e.length)return n(e)?1===e.length?e[0]:{type:"compound",compound:[...e]}:void 0}function v(e,t,n,o){if(void 0!==e){if("complex"===e.type)v(e.left,t,n,e),v(e.right,t,n,e);else if("compound"===e.type)for(const o of e.compound)v(o,t,n,e);else"pseudo-class"===e.type&&e.subtree;t(e,o)}}function b(e,t,n){const{property:o,value:r,isRegex:s}=function(e){const t=e.indexOf(":");if(-1===t)throw new Error("Invalid CSS value format: no colon found");const n=e.slice(0,t).trim(),o=e.slice(t+1).trim(),r=o.startsWith("/")&&o.lastIndexOf("/")>0;return{property:n,value:o,isRegex:r}}(t),i=e.ownerDocument&&e.ownerDocument.defaultView;if(!i)throw new Error("No window context for element");const c=i.getComputedStyle(e,n)[o];if(s){return x(r).test(c)}return c===r}function x(e){if(e.startsWith("/")&&e.lastIndexOf("/")>0){const t=e.lastIndexOf("/"),n=e.slice(1,t),o=e.slice(t+1);if(!/^[gimsuyd]*$/.test(o))throw new Error(`Invalid regex flags: ${o}`);return new RegExp(n,o)}return new RegExp(e)}function S(e){return e.startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'")?e.slice(1,-1):e}function w(e,t){var n;if("id"===t.type||"class"===t.type||"type"===t.type||"attribute"===t.type)return e.matches(t.content);if("list"===t.type)return t.list.some((t=>w(e,t)));if("compound"===t.type)return t.compound.every((t=>w(e,t)));if("pseudo-class"===t.type){if("has"===t.name)return void 0!==t.subtree&&0!==O(e,t.subtree).length;if("not"===t.name)return void 0!==t.subtree&&0===F(e,[t.subtree]).length;if("has-text"===t.name){const{argument:n}=t;if(void 0===n)return!1;const o=e.textContent;return null!==o&&function(e,t){if((e=S(e)).startsWith("/")&&(e.endsWith("/")||e.endsWith("/i"))){let n=!0;return(e=e.slice(1)).endsWith("/")?e=e.slice(0,-1):(e=e.slice(0,-2),n=!1),new RegExp(e,!1===n?"i":void 0).test(t)}return t.includes(e)}(n,o.trim())}if("min-text-length"===t.name){const n=Number(t.argument);if(Number.isNaN(n)||n<0)return!1;const o=e.textContent;return null!==o&&o.length>=n}if("matches-path"===t.name){const{argument:o}=t;if(void 0===o)return!1;const r=null===(n=e.ownerDocument)||void 0===n?void 0:n.defaultView;if(!r)return!1;const s=r.location.pathname+r.location.search;return x(o).test(s)}if("matches-attr"===t.name){const{argument:n}=t;if(void 0===n)return!1;const o=n.indexOf("=");let r,s;-1===o?r=n:(r=n.slice(0,o),s=n.slice(o+1)),r=S(r),s=s?S(s):void 0;let i=null;if((null==s?void 0:s.startsWith("/"))&&s.lastIndexOf("/")>0&&(i=x(s)),r.startsWith("/")&&r.lastIndexOf("/")>0){const t=x(r),n=[...e.attributes].filter((e=>t.test(e.name)));return s?n.some((e=>i?i.test(e.value):e.value===s)):n.length>0}{const t=e.getAttribute(r);return null!==t&&(!s||(i?i.test(t):t===s))}}if("matches-css"===t.name)return void 0!==t.argument&&b(e,t.argument);if("matches-css-after"===t.name)return void 0!==t.argument&&b(e,t.argument,"::after");if("matches-css-before"===t.name)return void 0!==t.argument&&b(e,t.argument,"::before")}return!1}function E(e,t){if("pseudo-class"===t.type){if("upward"===t.name){if(void 0===t.argument)return[];const n=S(t.argument);let o=e,r=Number(n);if(Number.isInteger(r)){if(r<=0||r>=256)return[];for(;null!==(o=o.parentElement);)if(0==--r)return[o]}else for(;null!==(o=o.parentElement);)if(o.matches(n))return[o];return[]}if("xpath"===t.name)return void 0===t.argument?[]:function(e,t){try{if("undefined"==typeof Node||"undefined"==typeof XPathResult)return[];const n=e.ownerDocument.evaluate(t,e,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);if(n.resultType!==XPathResult.ORDERED_NODE_SNAPSHOT_TYPE)return[];const o=[];for(let e=0;e<n.snapshotLength;e++){const t=n.snapshotItem(e);(null==t?void 0:t.nodeType)===Node.ELEMENT_NODE&&o.push(t)}return o}catch(e){return[]}}(e,t.argument)}return null}function F(e,t){if(0===t.length)return[];const n=[{element:e,index:0}],o=[];for(;n.length;){const e=n.pop(),{element:r}=e;let{index:s}=e;for(;s<t.length;s++){const e=E(r,t[s]);if(null!==e){n.push(...e.map((e=>({element:e,index:s+1}))));break}if(!1===w(r,t[s]))break}s!==t.length||o.includes(r)||o.push(r)}return o}function O(e,t){if("id"===t.type||"class"===t.type||"type"===t.type||"attribute"===t.type)return Array.from(e.querySelectorAll(t.content));if("list"===t.type){const n=[];for(const o of t.list)for(const t of O(e,o))n.includes(t)||n.push(t);return n}if("compound"===t.type){const n=[],[o,...r]=t.compound;for(const t of O(e,o))for(const e of F(t,r))n.includes(e)||n.push(e);return n}if("complex"===t.type)return function(e,t){const n=void 0===t.left?[e]:O(e,t.left),o="compound"===t.right.type?t.right.compound:[t.right],r=new Set;switch(t.combinator){case" ":for(const e of n)for(const t of e.querySelectorAll("*"))for(const e of F(t,o))r.add(e);break;case">":for(const e of n)for(const t of e.children)for(const e of F(t,o))r.add(e);break;case"~":for(const e of n){let t=e;for(;null!==(t=t.nextElementSibling);)for(const e of F(t,o))r.add(e)}break;case"+":for(const e of n)if(null!==e.nextElementSibling)for(const t of F(e.nextElementSibling,o))r.add(t)}return Array.from(r)}(e,t);if("pseudo-class"===t.type){const n=[];for(const o of e.querySelectorAll("*"))for(const e of F(o,[t]))n.includes(e)||n.push(e);return n}return[]}const T=new Set(["has-text","matches-path","matches-attr","matches-css","matches-css-after","matches-css-before","upward","xpath"]),N=new Set(["active","any","any-link","blank","checked","default","defined","dir","disabled","empty","enabled","first","first-child","first-of-type","focus","focus-visible","focus-within","fullscreen","has","host","host-context","hover","in-range","indeterminate","invalid","is","lang","last-child","last-of-type","left","link","matches","not","nth-child","nth-last-child","nth-last-of-type","nth-of-type","only-child","only-of-type","optional","out-of-range","placeholder-shown","read-only","read-write","required","right","root","scope","target","valid","visited","where"]),I=new Set(["after","before","first-letter","first-line"]);var D;e.SelectorType=void 0,(D=e.SelectorType||(e.SelectorType={}))[D.Normal=0]="Normal",D[D.Extended=1]="Extended",D[D.Invalid=2]="Invalid",e.EXTENDED_PSEUDO_CLASSES=T,e.PSEUDO_CLASSES=N,e.PSEUDO_ELEMENTS=I,e.classifySelector=function t(n){if(-1===n.indexOf(":"))return e.SelectorType.Normal;const r=g(n);let s=!1;for(const n of r)if("pseudo-class"===n.type){const{name:r}=n;if(!0===T.has(r))s=!0;else if(!1===N.has(r)&&!1===I.has(r))return e.SelectorType.Invalid;if("has"===r&&void 0!==n.argument&&-1!==n.argument.indexOf(":has(")&&(s=!0),!1===s&&void 0!==n.argument&&!0===o.has(r)){const o=t(n.argument);if(o===e.SelectorType.Invalid)return o;o===e.SelectorType.Extended&&(s=!0)}}return!0===s?e.SelectorType.Extended:e.SelectorType.Normal},e.isAST=n,e.isAtoms=t,e.matches=w,e.parse=function e(t,{recursive:n=!0,list:r=!0}={}){const s=g(t);if(0===s.length)return;const i=y(s,{list:r});return!0===n&&v(i,(t=>{"pseudo-class"===t.type&&t.argument&&void 0!==t.name&&o.has(t.name)&&(t.subtree=e(t.argument,{recursive:!0,list:!0}))})),i},e.querySelectorAll=O,e.tokenize=g}));
//# sourceMappingURL=adblocker.umd.min.js.map
