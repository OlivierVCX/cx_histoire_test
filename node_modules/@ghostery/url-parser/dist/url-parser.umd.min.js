!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("tldts-experimental")):"function"==typeof define&&define.amd?define(["exports","tldts-experimental"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["url-parser"]={},t.tldtsExperimental)}(this,(function(t,e){"use strict";const r=35,s=59,h=63;class a{get[Symbol.toStringTag](){return"URLSearchParams"}constructor(t){this.isEncoded=!1,this.params=[],"string"==typeof t?i(t,"?"===t[0]?1:0,t.length,this,[38],61,[],{encode:!0}):Array.isArray(t)?t.forEach((t=>{this.append(t[0],t[1])})):"object"==typeof t&&Object.keys(t).forEach((e=>{this.append(e,t[e])}))}*entries(){for(let t=0;t<this.params.length;t+=1)yield[o(this.params[t][0]),o(this.params[t][1])]}append(t,e){this.params.push([n(t),n(e)])}delete(t){this.params=this.params.filter((([e])=>o(e)!==t))}forEach(t){this.params.forEach((([e,r])=>{t(o(r),o(e),this)}))}get(t){const e=this.params.find((([e])=>o(e)===t));return e?o(e[1]):null}getAll(t){return this.params.filter((([e])=>o(e)===t)).map((t=>t[1]))}has(t){return null!==this.get(t)}*keys(){for(let t=0;t<this.params.length;t+=1)yield o(this.params[t][0])}set(t,e){const r=this.params.findIndex((([e])=>o(e)===t));-1!==r?(this.delete(t),this.params.splice(r,0,[n(t),n(e)])):this.append(t,e)}sort(){this.params=this.params.sort(((t,e)=>t[0].localeCompare(e[0])))}toString(){return this.params.map((([t,e])=>`${t}=${e}`)).join("&")}*values(){for(let t=0;t<this.params.length;t+=1)yield o(this.params[t][1])}[Symbol.iterator](){return this.entries()}get size(){return this.params.length}}function i(t,e,r,s,h,a,i,{encode:o}={encode:!1}){let n=e,l=n,c=0,p=0;const u=o?s.append.bind(s):(t,e)=>s.params.push([t,e]);for(;n<=r;n+=1){const e=t.charCodeAt(n);if(e===a&&0===c)c=n,p=n+1;else if(-1!==h.indexOf(e))n>l&&u(t.slice(l,c||n),t.slice(p||n,n)),l=n+1,c=0,p=0;else if(-1!==i.indexOf(e))break}return n!==l&&u(t.slice(l,c||n),t.slice(p||n,n)),n}function o(t){if(-1===t.indexOf("%"))return t;try{return decodeURIComponent(t.replace(/\+/g," "))}catch(e){return t}}function n(t){const e=""+t;let r="";for(let t=0;t<e.length;t++)32===e.charCodeAt(t)?r+="+":r+=encodeURIComponent(e[t]);return r}const l=[47,r,h];function c(t){return t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||45===t||43===t}class p{constructor(t){this.parse(t)}get protocol(){return this._protocol}get username(){return this._username}get password(){return this._password}get hostname(){return this._hostname}get host(){return this._host}get port(){return this._port}get pathname(){return this._pathname}get search(){return this._search||this._extractParams(),this._search}get searchParams(){return this.isQueryParsed||this._extractSearchParams(),this._query}get parameters(){return this.isQueryParsed||this._extractSearchParams(),this._parameters}hasParameterString(){return this.parameterStartIndex>0}get hash(){return this._search||this._hash||this._extractParams(),this._hash}get href(){return this._href}toString(){return this.href}toJSON(){return this.href}get domainInfo(){return this._domainInfo||(this._domainInfo=e.parse(this.hostname,{extractHostname:!1})),this._domainInfo}get hostIsIp(){return this.domainInfo.isIp}get domain(){return this.domainInfo.hostname||this.hostname}get generalDomain(){return this.domainInfo.domain||this.hostname}get path(){return this.pathname||"/"}get scheme(){return this.protocol.slice(0,-1)}isValidHost(){return this.hostIsIp||null!==this.generalDomain}extractKeyValues(){if(this.parsedParameters)return this.parsedParameters;if(this.parsedParameters=new a,0===this.queryStartIndex&&0===this.parameterStartIndex)return this.parsedParameters;const t=this.parameterStartIndex||this.queryStartIndex,e=this.href.length-1;let i=t;return this.href.charCodeAt(i)===s&&(i=this._extractParamTuples(i+1,e,this.parsedParameters,[s],61,[h,r])),this.href.charCodeAt(i)===h&&(i=this._extractParamTuples(i+1,e,this.parsedParameters,[38,s],61,[r])),this.parsedParameters}_extractHostname(t,e){let r=0,s=!1,h=t,a=!1,i=!1;if(91===this._href.charCodeAt(h))for(a=!0;h<=e;h+=1){if(93===this._href.charCodeAt(h)){const t=this._href.charCodeAt(h+1);if(58===t)r=h+1,h+=1,s=!0;else if(47===t)h+=1,s=!0;else if(h!==e)throw new TypeError("expected `:` or `/` after IPv6 address");break}}if(!a)for(;h<=e;h+=1){const a=this._href.charCodeAt(h);if(58===a){r=h,s=!0;break}if(64===a)return this._username=this._href.slice(t,h),this._password="",this._extractHostname(h+1,e);if(-1!==l.indexOf(a)){s=!0;break}if(a<=32)throw new TypeError(`Invalid character '${this.href[h]}' in hostname`);a>=65&&a<=90&&(i=!0)}const o=s?h:h+1;if(i&&(this._href=`${this._href.slice(0,t)}${this._href.slice(t,o).toLowerCase()}${this._href.slice(o)}`),this._hostname=this._href.slice(t,o),r>0){h+=1;const s=h;let a=!1;for(;h<=e;h+=1){const i=this._href.charCodeAt(h);if(-1!==l.indexOf(i)){this._port=this._href.slice(s,h);break}if(64===i)return this._username=this._href.slice(t,r||h),this._password=this._href.slice(r+1,h),this._extractHostname(h+1,e);(i<48||i>57)&&(a=!0)}if(this._port||(this._port=this.href.slice(s,h)),a)throw new TypeError("Invalid URL: port contains non numeric character");if(this._port.length>=5&&+this._port>65535)throw new TypeError("Invalid URL: invalid port number")}return this._host=this._href.slice(t,s?h:h+1),this.origin=`${this._protocol}//${this._host}`,s?h:h+1}_extractParams(){if(this.queryStartIndex>0){let t=this.queryStartIndex;const e=this.href.length-1;if(this.href.charCodeAt(t)===h){let s=!1;for(;t<=e;t+=1)if(this.href.charCodeAt(t)===r){s=!0;break}this._search=this.href.slice(this.queryStartIndex,s?t:e+1),1===this._search.length&&(this._search="")}this.href.charCodeAt(t)===r&&(this._hash=this.href.slice(t,e+1))}}_extractSearchParams(){if(this.isQueryParsed=!0,0===this.queryStartIndex&&0===this.parameterStartIndex)return;const t=this.parameterStartIndex||this.queryStartIndex,e=this.href.length-1;let a=t;if(this.href.charCodeAt(a)===s&&(a=this._extractParamTuples(a+1,e,this._parameters,[s],61,[h,r])),this.href.charCodeAt(a)===h){const t=a;a=this._extractParamTuples(a+1,e,this._query,[38],61,[r]),this._search=this.href.slice(t,a),1===this._search.length&&(this._search="")}this.href.charCodeAt(a)===r&&(this._hash=this.href.slice(a,e+1))}_extractParamTuples(t,e,r,s,h,a){return i(this.href,t,e,r,s,h,a)}parse(t){if("string"!=typeof t||0===t.length)throw new TypeError(`${t} is not a valid URL`);this._protocol="",this._hostname="",this._host="",this._port="",this._pathname="",this._username="",this._password="",this._search="",this._hash="",this.parameterStartIndex=0,this.queryStartIndex=0,this.isQueryParsed=!1,this._parameters=new a,this._query=new a,this._domainInfo=null,this.parsedParameters=null;let e=0,i=t.length-1;for(;t.charCodeAt(e)<=32;)e+=1;for(;t.charCodeAt(i)<=32;)i-=1;this._href=t.slice(e,i+1),i=this._href.length-1;let o=!1;for(;e<=i;e+=1){const t=this._href.charCodeAt(e);if(58===t){this._protocol=this._href.slice(0,e+1),o&&(this._protocol=this._protocol.toLowerCase(),this._href=`${this._protocol}${this._href.slice(e+1)}`);break}if(!c(t))throw new TypeError("Invalid URL protocol");t>=65&&t<=90&&(o=!0)}if(e>=i)throw new TypeError("No protocol");for(this.slashes="",e+=1;e<i&&47===this._href.charCodeAt(e);e+=1)this.slashes+="/";if(this.slashes.length>=2?e=this._extractHostname(e,i):(this._host="",this._hostname="",this.origin="null"),e>=i)47!==this._href.charCodeAt(i)&&(this._href+="/"),this._pathname="/";else{const t=e;for(;e<=i;e+=1){const t=this._href.charCodeAt(e);if(t!==s||this.parameterStartIndex){if(t===h||t===r){this.queryStartIndex=e;break}}else this.parameterStartIndex=e}this._pathname=this.href.slice(t,0!==this.queryStartIndex?this.queryStartIndex:i+1)||"/"}}}class u extends a{constructor(t,e){super(),this.url=t,this.params=e.params}append(t,e){super.append(t,e),this.url.search=this.toString()}delete(t){super.delete(t),this.url.search=this.toString()}set(t,e){super.set(t,e),this.url.search=this.toString()}sort(){super.sort(),this.url.search=this.toString()}}function m(t,e){const r={hash:void 0!==e.hash?e.hash:t.hash,host:void 0!==e.host?e.host:t.host,hostname:void 0!==e.hostname?e.hostname:t.hostname,password:void 0!==e.password?e.password:t.password,pathname:void 0!==e.pathname?e.pathname:t.pathname,port:void 0!==e.port?e.port:t.port,protocol:void 0!==e.protocol?e.protocol:t.protocol,search:void 0!==e.search?e.search:t.search,username:void 0!==e.username?e.username:t.username};(e.hostname||e.port)&&(("https:"===r.protocol&&"443"===r.port||"http:"===r.protocol&&"80"===r.port)&&(r.port=""),r.host=`${r.hostname}${r.port?":":""}${r.port}`);const s=r.username?r.password?`${r.username}:${r.password}@`:`${r.username}@`:r.password?`:${r.password}@`:"";return new p(`${r.protocol}${t.slashes}${s}${r.host}${r.pathname}${r.search}${r.hash}`)}class d{get[Symbol.toStringTag](){return"URL"}constructor(t){this.url=new p(t)}get protocol(){return this.url.protocol}set protocol(t){const e=this.url.protocol,r=t.endsWith(":")?"":":",s=`${t}${r}${this.href.slice(e.length)}`;this.url=new p(s)}get username(){return this.url.username}set username(t){this.url=m(this,{username:t||""})}get password(){return this.url.password}set password(t){this.url=m(this,{password:t||""})}get hostname(){return this.url.hostname}set hostname(t){this.url=m(this,{hostname:t||""})}get host(){return this.url.host}set host(t){this.url=m(this,{host:t})}get origin(){return this.url.origin}get port(){return this.url.port}set port(t){this.url=m(this,{port:t||""})}get pathname(){return this.url.pathname}set pathname(t){const e=47===t.charCodeAt(0)?t:`/${t}`;this.url=m(this,{pathname:e})}get search(){return this.url.search}set search(t){const e=t.charCodeAt(0)===h?t.slice(1):t;this.url=m(this,{search:e.length>0?`?${e}`:""})}get searchParams(){return new u(this,this.url.searchParams)}get parameters(){return this.url.parameters}hasParameterString(){return this.url.hasParameterString()}get hash(){return this.url.hash}set hash(t){const e=t.charCodeAt(0)===r?t.slice(1):t;this.url=m(this,{hash:e.length>0?`#${e}`:""})}get href(){return this.url.href}set href(t){this.url=new p(t)}toString(){return this.href}toJSON(){return this.href}get domainInfo(){return this.url.domainInfo}get hostIsIp(){return this.url.hostIsIp}get domain(){return this.url.domain}get generalDomain(){return this.url.generalDomain}get path(){return this.url.path}get scheme(){return this.url.scheme}get slashes(){return this.url.slashes}isValidHost(){return this.url.isValidHost()}extractKeyValues(){return this.url.extractKeyValues()}}t.ImmutableURL=p,t.URL=d,t.URLSearchParams=a,t.getPunycodeEncoded=function(t,e){const r=t(e.hostname);return r!==e.hostname?new d(`${e.protocol}${e.slashes}${r}${e.pathname}${e.search}${e.hash}`):e}}));
//# sourceMappingURL=url-parser.umd.min.js.map
