!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@ghostery/url-parser"),require("@remusao/smaz"),require("@ghostery/adblocker-extended-selectors"),require("@remusao/guess-url-type"),require("tldts-experimental"),require("@remusao/small")):"function"==typeof define&&define.amd?define(["exports","@ghostery/url-parser","@remusao/smaz","@ghostery/adblocker-extended-selectors","@remusao/guess-url-type","tldts-experimental","@remusao/small"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).adblocker={},e.urlParser,e.smaz,e.adblockerExtendedSelectors,e.guessUrlType,e.tldtsExperimental,e.small)}(this,(function(e,t,s,i,r,o,n){"use strict";var a=[", document.addEventListene",", document.createElement, ",", document.getElementById,","%5Bhref%5E%3D%22https%3A%2","aopr, app_vars.force_disab","%22%3A%22denied%22%2C%22","aeld, DOMContentLoaded, ","nosiif, visibility, 1000","set-local-storage-item, ","acs, addEventListener, ","trusted-click-element, ","-if, googlesyndication","_ENSIGHTEN_PRIVACY_","set, blurred, false",'[target="_blank"]',"%22%3Afalse%2C%22",'[href^="https://',"%22%3Atrue%2C%22",'[href^="http://','[data-testid="',"%22%3Afalse%7D","rmnt, script, ",", , reload, 1","BlockDetected","onselectstart",'div[class^="',"trusted-set-",", document.",".prototype.","contextmenu","leaderboard","otification",":has-text(","background","analytics","container","Container","decodeURI",'div[id^="',"div[style","no-xhr-if","placehold",'[href*="',"AAAAAAAA","backdrop","disclaim","https://","no-fetch","noopFunc",'.com/"]',"article","consent","Consent","content","display","keydown","message","overlay","privacy","product","sidebar","sponsor","wrapper","-child","[class","[data-","accept","banner","bottom","button","cookie","Cookie","COOKIE","google","necess","nostif","notice","nowoif","policy","Policy","script","widget",":has(",":not(","Accep","block","Block","click","disab","false","fixed","frame","modal","popup","taboo",".com","0px;","2%3A","2%5D","aeld","aopr","body","foot","gdpr","html","icky","ight","Info","set-","show","tion","true","www."," > ","%3A","%3D","%5B","%5C","522","52C","53A","age","app","box","div","dow","ent","out","rap","top","__",", ",": ",".m",'"]',"%2","%7",'="',"00","ac","ad","Ad","al","an","ar","at","de","e-","ed","el","en","er","es","et","g-","he","id","im","in","is","it","la","le","li","lo","o-","ol","om","on","op","or","ra","re","ro","s_","s-","se","si","sp","st","t-","te","ti","tr","un"," ","_","-",";",":",".","(",")","[","]","*","/","#","^","0","1","2","3","4","5","6","7","8","9","a","b","B","c","C","d","D","e","E","f","F","g","G","h","H","i","I","j","k","l","L","m","M","n","N","o","O","p","P","q","r","R","s","S","t","T","u","U","v","V","w","W","x","y","z"],c=["sandbox allow-forms allow-same-origin allow-scripts allow-modals allow-orientation-lock allow-pointer-lock allow-presentation allow-top-navigation","script-src 'self' 'unsafe-inline' 'unsafe-eval' "," data: blob: mediastream: filesystem:","default-src 'unsafe-inline' 'self' "," allow-same-origin allow-scripts","script-src 'self' 'unsafe-eval' "," *.google.com *.gstatic.com *.","gle.com *.googletagmanager.com","script-src * 'unsafe-inline'","default-src 'self'","child-src 'none';","worker-src 'none'","*.gstatic.com *.","'unsafe-inline'","e-src 'self' *","googleapis.com"," allow-modals","unsafe-eval'","child-src *","gstatic.com","script-src ","style-src *"," https://","facebook.","frame-src"," allow-"," https:",".com *.","'self' ","sandbox","data: ","disqus","google","ation","http:","-src",".com","n.cc"," *.","avi","ent","net","ram","yti"," '"," f","*.","ad","as","cd","ck","co","er","go","he","ic","im","in","lo","on","or","re","ta","tu"," ","-",";",":",".","'","*","/","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y"],l=[',ipaddress=/^(1(72\\.67\\.\\d{3}|04\\.21\\.\\d+)\\.\\d+|188\\.114\\.9[67]\\.[08]|64:ff9b::[a-f0-9]{4}:[a-f0-9]{1,4})$/,replace=\'/^/<script>(()=>{window.open=new proxy(window.open,{apply:(n,o,w)=>{}});let e=document.queryselector("script");e.innerhtml.includes("window.open")&&e.parentelement.removechild(e)})();<\\/script>/i\'',")?[_0-9a-z]{6,16}\\/?[_0-9a-z]{5,120}(?:[-.](?:app|bundle|ma?in|module|prod|index|v\\d|vendor))?(?:\\.js)?$/$script,3p,match-case,to=com|~aswpsdkus.com|~chimpstatic.com|~mojirater.com|~polldaddy.com|~squareoffs.com|~succeedscene.com|~tallysight.com|~veraviews.com,","/^https:\\/\\/(?:www\\d\\.)?[-a-z]{6,}\\.(?:club|com|info|net|org)\\/(?=[-_a-zA-Z]{0,42}\\d)(?=[-_0-9a-z]{0,42}[A-Z])[-_0-9a-zA-Z]{43}\\/\\?","/^https:\\/\\/[0-9a-z]{7,25}\\.com\\/(?:assets|build|bundles|chunks|dist|files|j|public|scripts|static)?\\/?(?:js\\/","/^https:\\/\\/s[cfntz]y?[ace][acemnu][a-z]{1,4}or?[mn][a-z]{4,8}[iy][a-z]?\\.","/videojs-vast-vpaid@2.0.2/bin/videojs_5.vast.vpaid.min","*&iu=%2f18190176%2c22509719621%2fadthrive_video_","/(\\d{0,1})?tamilprint(\\d{1,2})?\\.[a-z]{3,7}/##","\\/[a-zA-Z0-9]{30,}\\?[a-zA-Z0-9]{25,}$/","/pagead/managed/js/gpt/*/pubads_impl","[-.][-a-z0-9][-a-z0-9]+\\.[a-z]+\\//","/extensions/*/appmeasurement","\\.pussyspace\\.(?:com|net)\\/","/pagead/js/adsbygoogle.js","/js/sdkloader/ima3.js","/js/sdkloader/ima3_d","/videojs-contrib-ads","/wp-content/plugins/","/wp-content/uploads/","/public/widget/data","/wp-content/themes/","/detroitchicago/","/appmeasurement","/cdn-cgi/trace","/^https?:\\/\\/","/^https:\\/\\/","fingerprint","/413gkwmt/","impression","[a-z0-9]{","/plugins/","affiliate","analytics","telemetry","[a-f0-9]","/assets/","/images/","tracking","/public","300x250","captcha","collect","consent","content","counter","metrics","privacy","/media","banner","bundle","client","cookie","dn-cgi","google","module","prebid","script","source","widget",".aspx",".cgi?",".com/",".html","[a-z]","/api/","/beac","/java","/stat","0x600","a-z]{","block","click","count","embed","event","fault","frame","image","manag","pixel","popup","theme","track","type=","video","visit",".css",".gif",".jpg",".min",".php",".png","[0-9","/img","/jqu","/js/","/lib","/log","/web","/wp-","468x","gi-b","html","http","mail","page","play","plug","tect","uild","view",".js","(?:","/ad","%2f","=*&","com","dpr","id=","jax","key","log","sdk","tag","web",":/","*.","*/","/_","/?","/*","/d","/f","/g","/h","/m","/n","/r","/u","/w","\\.","\\/","a-","ac","ad","ag","al","am","an","ap","ar","as","at","ce","ch","co","de","di","e/","ed","el","en","er","et","ic","id","ig","im","in","it","js","la","le","li","lo","mp","ol","om","on","op","or","ot","re","ro","s_","s-","s?","s/","sh","si","sp","st","t/","te","ti","tm","tr","ub","un","ur","ut","ve","_","-",",","?",".",")","[","{","}","*","/","\\","&","^","=","|","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],h=[".actonservice.com","googlesyndication","imasdk.googleapis",".cloudfront.net","analytics.","marketing.","tracking.",".website","metrics.",".online","digital",".co.uk",".space","a8clk.","stats.",".shop",".site","a8cv.","click","image","media","track",".com",".net",".top",".xyz","www.",".io",".jp","app","cdn","ght","new","pro","web",".b",".c",".f",".h",".m",".n",".p",".s",".w","a1","a2","a4","ab","ac","ad","af","ag","ah","ai","ak","al","am","an","ap","ar","as","at","au","av","aw","ax","ay","az","be","bl","bo","br","bu","ca","ce","ch","ci","ck","cl","cr","ct","cu","de","di","do","dr","ds","du","dy","e-","eb","ec","ed","ef","el","em","en","ep","er","es","et","eu","ev","ew","ex","fd","fe","ff","fi","fo","fr","ge","gl","gn","go","gr","gu","gy","he","ho","ia","ib","ic","id","ie","if","ig","ik","il","im","in","io","ip","ir","is","it","iv","ix","iz","jo","ke","kr","ks","la","ld","le","li","lo","lu","ly","ma","me","mo","mp","my","nd","ne","no","nt","ob","ol","om","on","oo","op","or","ot","ou","ow","ph","pl","po","pr","pt","pu","qp","qu","re","ri","ro","ru","s-","sc","se","sh","si","sk","so","sp","ss","st","su","sw","sy","te","th","ti","to","tr","ts","tu","tv","tw","ty","ub","ul","um","un","up","ur","us","ut","ve","vi","vo","we","-",".","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],d=["google-analytics.com/analytics.js","googlesyndication_adsbygoogle.js","googletagmanager.com/gtm.js","googletagservices_gpt.js","googletagmanager_gtm.js","fuckadblock.js-3.2.0:5","amazon_apstag.js","google-analytics","fingerprint2.js","noop-1s.mp4:10","google-ima.js","noop-0.1s.mp3","prebid-ads.js","nobab2.js:10","noopmp3-0.1s","noop-1s.mp4","noopmp4-1s","32x32.png","noop.html","noopframe","noop.txt","nooptext","1x1.gif","2x2.png","noop.js","noopjs",".com/",".js:5","none","noop",":10",".js","ads","bea","_a",":5",".0","ar","ch","ic","in","le","ma","re","st","_","-",":",".","/","0","1","2","3","4","5","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","r","s","t","u","v","w","x","y","z"],u=[".actonservi","/^https:\\/\\","/js/sdkload","/wp-content","||smetrics.","third-party","xmlhttprequ","-rule=noop","marketing.",",redirect",".digital^",".website^","$document","analytics",",domain=",".online^","metrics.","tracking",".space^","$script","imasdk.",".co.uk",".cyou^",".help^",".shop^",".site^","$ghide","a8clk.","cookie","google","script",".com^",".net^",".top^",".xyz^","$doma","a8cv.","click","image","media","track",".com",".fr^",".gif",".io^",".jp^","/js/","$doc","$xhr","a-z]","www.",",1p",",3p",".js","cdn","fd^","ld^","web",".b",".c",".f",".m",".n",".p",".s",".w","@@","/*","/p","||","ab","ac","ad","af","ag","ai","ak","al","am","an","ap","ar","as","at","au","av","aw","ax","ay","az","be","bi","bo","br","ca","ce","ch","ck","ct","cu","de","di","do","e-","eb","ec","ed","el","em","en","ep","er","es","et","ev","ew","ex","fe","ff","fi","fo","fr","g^","ge","gi","go","gr","he","hi","ho","hp","ht","ic","id","ig","il","im","in","io","ip","ir","is","it","ix","jo","js","ke","l^","la","le","li","lo","lu","ly","ma","me","mo","mp","my","no","ol","om","on","oo","op","or","ot","pl","po","pr","qu","re","ri","ro","ru","s/","sc","se","sh","si","so","sp","ss","st","sw","t-","te","th","ti","to","tr","ts","tv","ty","ub","ud","ul","um","un","up","ur","us","ut","ve","vi","_","-",",","?",".","*","/","\\","^","=","|","~","$","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],f=[" !important;","-storage-ite","-touch-callo",'[href^="http',"%22%3Afalse%",'div[class^="',"nt, script, ","trusted-clic","trusted-set-","user-select:",", document.","contextmenu","k-element, ","ut: default",":has-text(",".com##+js(","background","flow: auto",".*,xhamst","container","-webkit",":style(","AAAAAAA","consent","content","nowoif)","privacy","-wrapp",".co.uk","[class","[data-",'[id^="',"##+js(","accept","banner","bottom","cookie","Cookie","google","policy","script"," text",":has(",".com,","1000)","block","true)",".com",".cz,",".de,",".fr,",".pl,","#@#.","aeld","butt","gdpr","html","ight","news","s://","www."," > ","##.","###","%3A","%3D","%5B","%5C","%5D","522","52C","53A","acs","age","web","__","-s",", ",": ",".*",".b",".n",".p",".t",'"]',"##","%2","%7",'="',"00","ab","ac","ad","Ad","al","am","an","ap","ar","as","at","au","bi","bo","ce","ch","ck","co","ct","d-","da","de","di","do","ed","el","en","er","es","et","fi","fo","g-","ga","ge","go","he","ho","ic","id","ie","if","il","im","in","is","it","ke","la","ld","le","li","lo","ma","me","mi","mo","mp","na","ne","no","ol","on","op","or","ot","ov","po","pp","ra","re","ro","ru","s_","s-","sc","se","sh","si","sk","so","sp","ss","st","t-","ta","te","th","ti","to","ub","ul","um","un","up","ur","us","ut","ve","vi","xh","y-"," ","_","-",",",";",":",".","(",")","[","*","/","0","1","2","3","4","5","6","7","8","9","a","b","B","c","C","d","D","e","E","f","F","g","h","i","I","j","k","l","L","m","M","n","N","o","O","p","P","q","r","R","s","S","t","T","u","v","w","x","y","z"];class p{constructor(){this.cosmeticSelector=new s.Smaz(a),this.networkCSP=new s.Smaz(c),this.networkRedirect=new s.Smaz(d),this.networkHostname=new s.Smaz(h),this.networkFilter=new s.Smaz(l),this.networkRaw=new s.Smaz(u),this.cosmeticRaw=new s.Smaz(f,8e5)}}const m=(()=>{let e=0;const t=new Int32Array(256);for(let s=0;256!==s;s+=1)e=s,e=1&e?-306674912^e>>>1:e>>>1,e=1&e?-306674912^e>>>1:e>>>1,e=1&e?-306674912^e>>>1:e>>>1,e=1&e?-306674912^e>>>1:e>>>1,e=1&e?-306674912^e>>>1:e>>>1,e=1&e?-306674912^e>>>1:e>>>1,e=1&e?-306674912^e>>>1:e>>>1,e=1&e?-306674912^e>>>1:e>>>1,t[s]=e;return t})();const g=new Uint8Array(0),y=new Uint32Array(0),w=1===new Int8Array(new Int16Array([1]).buffer)[0],v=new TextEncoder;let b,x=()=>{const e=new p;return x=()=>e,e};function k(e){return e<=127?1:5}function S(e,t){return F(e.length,t)}function F(e,t){return(t?3:0)+e+k(e)}function z(e){return e.length+k(e.length)}function I(e){const t=v.encode(e).length;return t+k(t)}function A(e){return e.byteLength+k(e.length)}class C{static empty(e){return C.fromUint8Array(g,e)}static fromUint8Array(e,t){return new C(e,t)}static allocate(e,t){return new C(new Uint8Array(e),t)}constructor(e,{enableCompression:t}){if(!1===w)throw new Error("Adblocker currently does not support Big-endian systems");!0===t&&this.enableCompression(),this.buffer=e,this.pos=0}enableCompression(){this.compression=x()}checksum(){return function(e,t,s){let i=-1;const r=s-7;let o=t;for(;o<r;)i=i>>>8^m[255&(i^e[o++])],i=i>>>8^m[255&(i^e[o++])],i=i>>>8^m[255&(i^e[o++])],i=i>>>8^m[255&(i^e[o++])],i=i>>>8^m[255&(i^e[o++])],i=i>>>8^m[255&(i^e[o++])],i=i>>>8^m[255&(i^e[o++])],i=i>>>8^m[255&(i^e[o++])];for(;o<r+7;)i=i>>>8^m[255&(i^e[o++])];return~i>>>0}(this.buffer,0,this.pos)}dataAvailable(){return this.pos<this.buffer.byteLength}setPos(e){this.pos=e}getPos(){return this.pos}seekZero(){this.pos=0}slice(){return this.checkSize(),this.buffer.slice(0,this.pos)}subarray(){return this.pos===this.buffer.byteLength?this.buffer:(this.checkSize(),this.buffer.subarray(0,this.pos))}align4(){this.pos=this.pos+3&-4}set(e){this.buffer=new Uint8Array(e),this.seekZero()}pushBool(e){this.pushByte(Number(e))}getBool(){return Boolean(this.getByte())}setByte(e,t){this.buffer[e]=t}pushByte(e){this.pushUint8(e)}getByte(){return this.getUint8()}pushBytes(e,t=!1){this.pushLength(e.length),!0===t&&this.align4(),this.buffer.set(e,this.pos),this.pos+=e.byteLength}getBytes(e=!1){const t=this.getLength();!0===e&&this.align4();const s=this.buffer.subarray(this.pos,this.pos+t);return this.pos+=t,s}getUint32ArrayView(e){if(this.align4(),0===e)return y;const t=new Uint32Array(this.buffer.buffer,this.pos+this.buffer.byteOffset,e);return this.pos+=4*e,t}pushUint8(e){this.buffer[this.pos++]=e}getUint8(){return this.buffer[this.pos++]}pushUint16(e){this.buffer[this.pos++]=e>>>8,this.buffer[this.pos++]=e}getUint16(){return(this.buffer[this.pos++]<<8|this.buffer[this.pos++])>>>0}pushUint32(e){this.buffer[this.pos++]=e>>>24,this.buffer[this.pos++]=e>>>16,this.buffer[this.pos++]=e>>>8,this.buffer[this.pos++]=e}getUint32(){return(this.buffer[this.pos++]<<24>>>0)+(this.buffer[this.pos++]<<16|this.buffer[this.pos++]<<8|this.buffer[this.pos++])>>>0}pushUint32Array(e){this.pushLength(e.length);for(const t of e)this.pushUint32(t)}getUint32Array(){const e=this.getLength(),t=new Uint32Array(e);for(let s=0;s<e;s+=1)t[s]=this.getUint32();return t}pushUTF8(e){const t=this.getPos(),s=t+k(e.length),{written:i}=v.encodeInto(e,this.buffer.subarray(s));t+k(i)!==s&&this.buffer.copyWithin(t+5,s,s+i),this.setPos(t),this.pushLength(i),this.setPos(this.pos+i)}getUTF8(){const e=this.getLength();return this.pos+=e,new TextDecoder("utf8",{ignoreBOM:!0}).decode(this.buffer.subarray(this.pos-e,this.pos))}pushASCII(e){this.pushLength(e.length);for(let t=0;t<e.length;t+=1)this.buffer[this.pos++]=e.charCodeAt(t)}getASCII(){const e=this.getLength();return this.pos+=e,String.fromCharCode.apply(null,this.buffer.subarray(this.pos-e,this.pos))}pushNetworkRedirect(e){void 0!==this.compression?this.pushBytes(this.compression.networkRedirect.compress(e)):this.pushASCII(e)}getNetworkRedirect(){return void 0!==this.compression?this.compression.networkRedirect.decompress(this.getBytes()):this.getASCII()}pushNetworkHostname(e){void 0!==this.compression?this.pushBytes(this.compression.networkHostname.compress(e)):this.pushASCII(e)}getNetworkHostname(){return void 0!==this.compression?this.compression.networkHostname.decompress(this.getBytes()):this.getASCII()}pushNetworkCSP(e){void 0!==this.compression?this.pushBytes(this.compression.networkCSP.compress(e)):this.pushASCII(e)}getNetworkCSP(){return void 0!==this.compression?this.compression.networkCSP.decompress(this.getBytes()):this.getASCII()}pushNetworkFilter(e){void 0!==this.compression?this.pushBytes(this.compression.networkFilter.compress(e)):this.pushASCII(e)}getNetworkFilter(){return void 0!==this.compression?this.compression.networkFilter.decompress(this.getBytes()):this.getASCII()}pushCosmeticSelector(e){void 0!==this.compression?this.pushBytes(this.compression.cosmeticSelector.compress(e)):this.pushASCII(e)}getCosmeticSelector(){return void 0!==this.compression?this.compression.cosmeticSelector.decompress(this.getBytes()):this.getASCII()}pushRawCosmetic(e){void 0!==this.compression?this.pushBytes(this.compression.cosmeticRaw.compress(v.encode(e))):this.pushUTF8(e)}getRawCosmetic(){return void 0!==this.compression?new TextDecoder("utf8",{ignoreBOM:!0}).decode(this.compression.cosmeticRaw.decompressRaw(this.getBytes())):this.getUTF8()}pushRawNetwork(e){void 0!==this.compression?this.pushBytes(this.compression.networkRaw.compress(v.encode(e))):this.pushUTF8(e)}getRawNetwork(){return void 0!==this.compression?new TextDecoder("utf8",{ignoreBOM:!0}).decode(this.compression.networkRaw.decompressRaw(this.getBytes())):this.getUTF8()}checkSize(){if(0!==this.pos&&this.pos>this.buffer.byteLength)throw new Error(`StaticDataView too small: ${this.buffer.byteLength}, but required ${this.pos} bytes`)}pushLength(e){e<=127?this.pushUint8(e):(this.pushUint8(128),this.pushUint32(e))}getLength(){const e=this.getUint8();return 128===e?this.getUint32():e}}class R{static deserialize(e){return new R({debug:e.getBool(),enableCompression:e.getBool(),enableHtmlFiltering:e.getBool(),enableInMemoryCache:e.getBool(),enableMutationObserver:e.getBool(),enableOptimizations:e.getBool(),enablePushInjectionsOnNavigationEvents:e.getBool(),guessRequestTypeFromUrl:e.getBool(),integrityCheck:e.getBool(),loadCSPFilters:e.getBool(),loadCosmeticFilters:e.getBool(),loadExceptionFilters:e.getBool(),loadExtendedSelectors:e.getBool(),loadGenericCosmeticsFilters:e.getBool(),loadNetworkFilters:e.getBool(),loadPreprocessors:e.getBool()})}constructor({debug:e=!1,enableCompression:t=!1,enableHtmlFiltering:s=!1,enableInMemoryCache:i=!0,enableMutationObserver:r=!0,enableOptimizations:o=!0,enablePushInjectionsOnNavigationEvents:n=!0,guessRequestTypeFromUrl:a=!1,integrityCheck:c=!0,loadCSPFilters:l=!0,loadCosmeticFilters:h=!0,loadExceptionFilters:d=!0,loadExtendedSelectors:u=!1,loadGenericCosmeticsFilters:f=!0,loadNetworkFilters:p=!0,loadPreprocessors:m=!1}={}){this.debug=e,this.enableCompression=t,this.enableHtmlFiltering=s,this.enableInMemoryCache=i,this.enableMutationObserver=r,this.enableOptimizations=o,this.enablePushInjectionsOnNavigationEvents=n,this.guessRequestTypeFromUrl=a,this.integrityCheck=c,this.loadCSPFilters=l,this.loadCosmeticFilters=h,this.loadExceptionFilters=d,this.loadExtendedSelectors=u,this.loadGenericCosmeticsFilters=f,this.loadNetworkFilters=p,this.loadPreprocessors=m}getSerializedSize(){return 16}serialize(e){e.pushBool(this.debug),e.pushBool(this.enableCompression),e.pushBool(this.enableHtmlFiltering),e.pushBool(this.enableInMemoryCache),e.pushBool(this.enableMutationObserver),e.pushBool(this.enableOptimizations),e.pushBool(this.enablePushInjectionsOnNavigationEvents),e.pushBool(this.guessRequestTypeFromUrl),e.pushBool(this.integrityCheck),e.pushBool(this.loadCSPFilters),e.pushBool(this.loadCosmeticFilters),e.pushBool(this.loadExceptionFilters),e.pushBool(this.loadExtendedSelectors),e.pushBool(this.loadGenericCosmeticsFilters),e.pushBool(this.loadNetworkFilters),e.pushBool(this.loadPreprocessors)}}const U="undefined"!=typeof window&&"function"==typeof window.queueMicrotask?e=>window.queueMicrotask(e):e=>(b||(b=Promise.resolve())).then(e).catch((e=>setTimeout((()=>{throw e}),0)));function T(e,t,s){let i=s.get(e);void 0===i&&(i=[],s.set(e,i)),i.push(t)}function E(e,t,s){const i=s.get(e);if(void 0!==i){const e=i.indexOf(t);-1!==e&&i.splice(e,1)}}function O(e,t,s){if(0===s.size)return!1;const i=s.get(e);return void 0!==i&&(U((()=>{for(const e of i)e(...t)})),!0)}class H{constructor(){this.onceListeners=new Map,this.onListeners=new Map}on(e,t){T(e,t,this.onListeners)}once(e,t){T(e,t,this.onceListeners)}unsubscribe(e,t){E(e,t,this.onListeners),E(e,t,this.onceListeners)}emit(e,...t){O(e,t,this.onListeners),!0===O(e,t,this.onceListeners)&&this.onceListeners.delete(e)}}function j(e,t){let s=3;const i=()=>e(t).catch((e=>{if(s>0)return s-=1,new Promise(((e,t)=>{setTimeout((()=>{i().then(e).catch(t)}),500)}));throw e}));return i()}function P(e,t){return j(e,t).then((e=>e.text()))}const L="https://raw.githubusercontent.com/ghostery/adblocker/master/packages/adblocker/assets",B=[`${L}/easylist/easylist.txt`,`${L}/peter-lowe/serverlist.txt`,`${L}/ublock-origin/badware.txt`,`${L}/ublock-origin/filters-2020.txt`,`${L}/ublock-origin/filters-2021.txt`,`${L}/ublock-origin/filters-2022.txt`,`${L}/ublock-origin/filters-2023.txt`,`${L}/ublock-origin/filters-2024.txt`,`${L}/ublock-origin/filters.txt`,`${L}/ublock-origin/quick-fixes.txt`,`${L}/ublock-origin/resource-abuse.txt`,`${L}/ublock-origin/unbreak.txt`],D=[...B,`${L}/easylist/easyprivacy.txt`,`${L}/ublock-origin/privacy.txt`],N=[...D,`${L}/easylist/easylist-cookie.txt`,`${L}/ublock-origin/annoyances-others.txt`,`${L}/ublock-origin/annoyances-cookies.txt`];function M(e,t){return Promise.all(t.map((t=>P(e,t))))}function _(e){return P(e,`${L}/ublock-origin/resources.json`)}const $=new class{constructor(e){this.pos=0,this.buffer=new Uint32Array(e)}reset(){this.pos=0}slice(){return this.buffer.slice(0,this.pos)}push(e){this.buffer[this.pos++]=e}empty(){return 0===this.pos}full(){return this.pos===this.buffer.length}remaining(){return this.buffer.length-this.pos}}(1024),W=37,q=5011;function V(e){return 16843009*((e=(858993459&(e-=e>>1&1431655765))+(e>>2&858993459))+(e>>4)&252645135)>>24}function G(e,t){return!!(e&t)}function K(e,t){return(e|t)>>>0}function Z(e,t){return(e&~t)>>>0}function X(e,t,s){let i=q;for(let r=t;r<s;r+=1)i=i*W^e.charCodeAt(r);return i>>>0}function Y(e){return"string"!=typeof e||0===e.length?q:X(e,0,e.length)}function J(e){const t=new Uint32Array(e.length);let s=0;for(const i of e)t[s++]=Y(i);return t}function Q(e){return e>=48&&e<=57}function ee(e){return e>=97&&e<=122||e>=65&&e<=90}function te(e){return ee(e)||Q(e)||37===e||function(e){return e>=192&&e<=450}(e)||function(e){return e>=1024&&e<=1279}(e)}function se(e,t,s,i){const r=Math.min(e.length,2*i.remaining());let o=!1,n=0,a=q;for(let s=0;s<r;s+=1){const r=e.charCodeAt(s);!0===te(r)?(!1===o&&(a=q,o=!0,n=s),a=a*W^r):!0===o&&(o=!1,s-n>1&&(!1===t||0!==n)&&i.push(a>>>0))}!0===o&&!1===s&&e.length-n>1&&!1===i.full()&&i.push(a>>>0)}function ie(e,t){const s=Math.min(e.length,2*t.remaining());let i=!1,r=0,o=q;for(let n=0;n<s;n+=1){const s=e.charCodeAt(n);!0===te(s)?(!1===i&&(o=q,i=!0,r=n),o=o*W^s):!0===i&&(i=!1,n-r>1&&t.push(o>>>0))}!0===i&&e.length-r>1&&!1===t.full()&&t.push(o>>>0)}function re(e){return $.reset(),ie(e,$),$.slice()}function oe(e,t){return-1!==function(e,t){if(0===e.length)return-1;let s=0,i=e.length-1;for(;s<=i;){const r=s+i>>>1,o=e[r];if(o<t)s=r+1;else{if(!(o>t))return r;i=r-1}}return-1}(e,t)}const ne=/[^\u0000-\u00ff]/;function ae(e){return ne.test(e)}const ce={extractHostname:!0,mixedInputs:!1,validateHostname:!1},le={beacon:Y("type:beacon"),cspReport:Y("type:csp"),csp_report:Y("type:csp"),cspviolationreport:Y("type:cspviolationreport"),document:Y("type:document"),eventsource:Y("type:other"),fedcm:Y("type:script"),fetch:Y("type:xhr"),font:Y("type:font"),image:Y("type:image"),imageset:Y("type:image"),json:Y("type:script"),mainFrame:Y("type:document"),main_frame:Y("type:document"),manifest:Y("type:other"),media:Y("type:media"),object:Y("type:object"),object_subrequest:Y("type:object"),other:Y("type:other"),ping:Y("type:ping"),prefetch:Y("type:other"),preflight:Y("type:preflight"),script:Y("type:script"),signedexchange:Y("type:signedexchange"),speculative:Y("type:other"),stylesheet:Y("type:stylesheet"),subFrame:Y("type:subdocument"),sub_frame:Y("type:subdocument"),texttrack:Y("type:other"),webSocket:Y("type:websocket"),web_manifest:Y("type:other"),websocket:Y("type:websocket"),xhr:Y("type:xhr"),xml_dtd:Y("type:other"),xmlhttprequest:Y("type:xhr"),xslt:Y("type:other")};function he(e){let t=q;for(let s=e.length-1;s>=0;s-=1)t=t*W^e.charCodeAt(s);return t>>>0}function de(e,t,s){$.reset();let i=q;for(let r=t-1;r>=0;r-=1){const t=e.charCodeAt(r);46===t&&r<s&&$.push(i>>>0),i=i*W^t}return $.push(i>>>0),$.slice()}function ue(e,t){const s=function(e,t){let s=null;const i=t.indexOf(".");if(-1!==i){const r=t.slice(i+1);s=e.slice(0,-r.length-1)}return s}(e,t);return null!==s?de(s,s.length,s.length):y}function fe(e,t){return de(e,e.length,e.length-t.length)}class pe{static fromRawDetails({requestId:e="0",tabId:t=0,url:s="",hostname:i,domain:r,sourceUrl:n="",sourceHostname:a,sourceDomain:c,type:l="main_frame",_originalRequestDetails:h}){if(void 0===i||void 0===r){const e=o.parse(s,ce);i=i||e.hostname||"",r=r||e.domain||""}if(void 0===a||void 0===c){const e=o.parse(a||c||n,ce);a=a||e.hostname||"",c=c||e.domain||a||""}return new pe({requestId:e,tabId:t,domain:r,hostname:i,url:s,sourceDomain:c,sourceHostname:a,sourceUrl:n,type:l,_originalRequestDetails:h})}constructor({requestId:e,tabId:t,type:s,domain:i,hostname:r,url:o,sourceDomain:n,sourceHostname:a,_originalRequestDetails:c}){if(this.tokens=void 0,this.hostnameHashes=void 0,this.entityHashes=void 0,this._originalRequestDetails=c,this.id=e,this.tabId=t,this.type=s,this.url=o,this.normalizedUrl=o.toLowerCase(),this.hostname=r,this.domain=i,this.sourceHostnameHashes=0===a.length?y:fe(a,n),this.sourceEntityHashes=0===a.length?y:ue(a,n),this.isThirdParty=function(e,t,s,i,r){return"main_frame"!==r&&"mainFrame"!==r&&(0!==t.length&&0!==i.length?t!==i:0!==t.length&&0!==s.length?t!==s:0!==i.length&&0!==e.length&&e!==i)}(r,i,a,n,s),this.isFirstParty=!this.isThirdParty,this.isSupported=!0,"websocket"===this.type||this.url.startsWith("ws:")||this.url.startsWith("wss:"))this.isHttp=!1,this.isHttps=!1,this.type="websocket",this.isSupported=!0;else if(this.url.startsWith("http:"))this.isHttp=!0,this.isHttps=!1;else if(this.url.startsWith("https:"))this.isHttps=!0,this.isHttp=!1;else if(this.url.startsWith("data:")){this.isHttp=!1,this.isHttps=!1;const e=this.url.indexOf(",");-1!==e&&(this.url=this.url.slice(0,e))}else this.isHttp=!1,this.isHttps=!1,this.isSupported=!1}getHostnameHashes(){return void 0===this.hostnameHashes&&(this.hostnameHashes=0===this.hostname.length?y:fe(this.hostname,this.domain)),this.hostnameHashes}getEntityHashes(){return void 0===this.entityHashes&&(this.entityHashes=0===this.hostname.length?y:ue(this.hostname,this.domain)),this.entityHashes}getTokens(){if(void 0===this.tokens){$.reset();for(const e of this.sourceHostnameHashes)$.push(e);$.push(le[this.type]),ie(this.normalizedUrl,$),this.tokens=$.slice()}return this.tokens}isMainFrame(){return"main_frame"===this.type||"mainFrame"===this.type}isSubFrame(){return"sub_frame"===this.type||"subFrame"===this.type}guessTypeOfRequest(){const e=this.type;return this.type=r(this.url),e!==this.type&&(this.tokens=void 0),this.type}}const me=2147483647,ge=/[^\0-\x7E]/,ye=/[\x2E\u3002\uFF0E\uFF61]/g,we={"invalid-input":"Invalid input","not-basic":"Illegal input >= 0x80 (not a basic code point)",overflow:"Overflow: input needs wider integers to process"};function ve(e){throw new RangeError(we[e])}function be(e,t){return e+22+75*(e<26?1:0)-0}function xe(e,t,s){let i=0;for(e=s?Math.floor(e/700):e>>1,e+=Math.floor(e/t);e>455;i+=36)e=Math.floor(e/35);return Math.floor(i+36*e/(e+38))}function ke(e){const t=[],s=function(e){const t=[];let s=0;const i=e.length;for(;s<i;){const r=e.charCodeAt(s++);if(r>=55296&&r<=56319&&s<i){const i=e.charCodeAt(s++);56320==(64512&i)?t.push(((1023&r)<<10)+(1023&i)+65536):(t.push(r),s--)}else t.push(r)}return t}(e),i=s.length;let r=128,o=0,n=72;for(let e=0;e<s.length;e+=1){const i=s[e];i<128&&t.push(String.fromCharCode(i))}const a=t.length;let c=a;for(a&&t.push("-");c<i;){let e=me;for(let t=0;t<s.length;t+=1){const i=s[t];i>=r&&i<e&&(e=i)}const i=c+1;e-r>Math.floor((me-o)/i)&&ve("overflow"),o+=(e-r)*i,r=e;for(let e=0;e<s.length;e+=1){const l=s[e];if(l<r&&++o>me&&ve("overflow"),l===r){let e=o;for(let s=36;;s+=36){const i=s<=n?1:s>=n+26?26:s-n;if(e<i)break;const r=e-i,o=36-i;t.push(String.fromCharCode(be(i+r%o))),e=Math.floor(r/o)}t.push(String.fromCharCode(be(e))),n=xe(o,i,c===a),o=0,++c}}++o,++r}return t.join("")}function Se(e){const t=e.replace(ye,".").split("."),s=[];for(let e=0;e<t.length;e+=1)s.push(ge.test(t[e])?"xn--"+ke(t[e]):t[e]);return s.join(".")}class Fe{static parse(e,{delimiter:t=",",debug:s=!1}={}){if("string"==typeof e){if(0===e.length)return}else if(0===e.size)return;const i="string"==typeof e?e.split(t):e;for(const e of i)if(0===e.length)return;const r=[],o=[],n=[],a=[],c=[];for(const e of i){let t=e;ae(t)&&(t=Se(t));const i=126===t.charCodeAt(0),l=42===t.charCodeAt(t.length-1)&&46===t.charCodeAt(t.length-2),h=i?1:0,d=l?t.length-2:t.length,u=he(!0===i||!0===l?t.slice(h,d):t);i?(l?o.push(u):a.push(u),s&&c.push(i?e:`~${e}`)):(l?r.push(u):n.push(u),s&&c.push(i?e.slice(1):e))}return new Fe({entities:0!==r.length?new Uint32Array(r).sort():void 0,hostnames:0!==n.length?new Uint32Array(n).sort():void 0,notEntities:0!==o.length?new Uint32Array(o).sort():void 0,notHostnames:0!==a.length?new Uint32Array(a).sort():void 0,parts:!0===s?c.join(t):void 0})}static deserialize(e){const t=e.getUint8();return new Fe({entities:1&~t?void 0:e.getUint32Array(),hostnames:2&~t?void 0:e.getUint32Array(),notEntities:4&~t?void 0:e.getUint32Array(),notHostnames:8&~t?void 0:e.getUint32Array(),parts:16&~t?void 0:e.getUTF8()})}constructor({entities:e,hostnames:t,notEntities:s,notHostnames:i,parts:r}){this.entities=e,this.hostnames=t,this.notEntities=s,this.notHostnames=i,this.parts=r}updateId(e){const{hostnames:t,entities:s,notHostnames:i,notEntities:r}=this;if(void 0!==t)for(const s of t)e=e*W^s;if(void 0!==s)for(const t of s)e=e*W^t;if(void 0!==i)for(const t of i)e=e*W^t;if(void 0!==r)for(const t of r)e=e*W^t;return e}serialize(e){const t=e.getPos();e.pushUint8(0);let s=0;void 0!==this.entities&&(s|=1,e.pushUint32Array(this.entities)),void 0!==this.hostnames&&(s|=2,e.pushUint32Array(this.hostnames)),void 0!==this.notEntities&&(s|=4,e.pushUint32Array(this.notEntities)),void 0!==this.notHostnames&&(s|=8,e.pushUint32Array(this.notHostnames)),void 0!==this.parts&&(s|=16,e.pushUTF8(this.parts)),e.setByte(t,s)}getSerializedSize(){let e=1;return void 0!==this.entities&&(e+=A(this.entities)),void 0!==this.hostnames&&(e+=A(this.hostnames)),void 0!==this.notHostnames&&(e+=A(this.notHostnames)),void 0!==this.notEntities&&(e+=A(this.notEntities)),void 0!==this.parts&&(e+=I(this.parts)),e}match(e,t){if(void 0!==this.notHostnames)for(const t of e)if(oe(this.notHostnames,t))return!1;if(void 0!==this.notEntities)for(const e of t)if(oe(this.notEntities,e))return!1;if(void 0!==this.hostnames||void 0!==this.entities){if(void 0!==this.hostnames)for(const t of e)if(oe(this.hostnames,t))return!0;if(void 0!==this.entities)for(const e of t)if(oe(this.entities,e))return!0;return!1}return!0}}function ze(e){if(!1===e.startsWith("^script"))return;const t=":has-text(",s=[];let i=7;for(;e.startsWith(t,i);){i+=10;let t=1;const r=i;let o=-1;for(;i<e.length&&0!==t;i+=1){const s=e.charCodeAt(i);92!==o&&(40===s&&(t+=1),41===s&&(t-=1)),o=s}s.push(e.slice(r,i-1))}return i===e.length?["script",s]:void 0}function Ie(e,t){const s=[],i=`<${t}`,r=`</${t}>`;let o=e.indexOf(i),n=0;for(;-1!==o;){const t=e.indexOf(">",o+i.length);if(-1===t)return[s,e.slice(0,o),e.slice(o)];if(47===e.charCodeAt(t-1))n=t+1,s.push([o,e.slice(o,n)]);else{const i=e.indexOf(r,t);if(-1===i)return[s,e.slice(0,o),e.slice(o)];s.push([o,e.slice(o,i+r.length)]),n=i+r.length}o=e.indexOf(i,n)}let a=e.lastIndexOf(">");-1===a&&(a=n);const c=e.indexOf("<",a);return-1===c||e.length-c>=i.length||!1===i.startsWith(e.slice(c))?[s,e,""]:[s,e.slice(0,c),e.slice(c)]}function Ae(e,t,s){for(const s of t)if(-1===e.indexOf(s))return!1;for(const t of s)if(!1===t.test(e))return!1;return!0}function Ce(e,t){const s=[];for(const i of t)for(const[t,r]of e)if(Ae(i[1],t,r)){s.push(i);break}return s}function Re(e,t){if(0===t.length)return e;let s=e;t.reverse();for(const[e,i]of t)s=s.slice(0,e)+s.slice(e+i.length);return s}const Ue=[y],Te="display: none !important;",Ee=new RegExp(/\\u002C/,"g"),Oe=new RegExp(/\\u005C/,"g"),He=new RegExp(/\\,/,"g"),je=new RegExp(/\\'/,"g"),Pe=new RegExp(/\\"/,"g"),Le=new RegExp(/\\`/,"g");function Be(e){for(let t=1;t<e.length;t+=1){const s=e.charCodeAt(t);if(!(45===s||95===s||s>=48&&s<=57||s>=65&&s<=90||s>=97&&s<=122)){if(t<e.length-1){const i=e.charCodeAt(t+1);if(91===s||46===s||58===s||32===s&&(62===i||43===i||126===i||46===i||35===i))return!0}return!1}}return!0}function De(e,t){return e.startsWith('href^="',t)||e.startsWith('href*="',t)||e.startsWith('href="',t)}const Ne=(()=>{const e="undefined"!=typeof document?document.createElement("div"):{matches:()=>{}},t=/^[#.]?[\w-.]+$/;return function(s){if(t.test(s))return!0;try{(t=>{e.matches(t)})(s)}catch(e){return!1}return!0}})();var Me;function _e(e,t){let s=e.getSelector();if(void 0!==e.style&&(s+=e.style),!1===e.isScriptInject())return s;const i=e.parseScript();if(void 0===i)return s;const r=t(i.name);return void 0===r?s:s.replace(i.name,r)}!function(e){e[e.unhide=1]="unhide",e[e.scriptInject=2]="scriptInject",e[e.isUnicode=4]="isUnicode",e[e.isClassSelector=8]="isClassSelector",e[e.isIdSelector=16]="isIdSelector",e[e.isHrefSelector=32]="isHrefSelector",e[e.remove=64]="remove",e[e.extended=128]="extended"}(Me||(Me={}));class $e{static parse(e,t=!1){const s=e;let r,o,n,a=0;const c=e.indexOf("#"),l=c+1;let h=l+1;if(e.length>l&&("@"===e[l]?(a=K(a,Me.unhide),h+=1):"?"===e[l]&&(h+=1)),h>=e.length)return null;if(c>0&&(o=Fe.parse(e.slice(0,c),{debug:t})),e.endsWith(":remove()"))a=K(a,Me.remove),a=K(a,Me.extended),e=e.slice(0,-9);else if(e.length-h>=8&&e.endsWith(")")&&-1!==e.indexOf(":style(",h)){const t=e.indexOf(":style(",h);n=e.slice(t+7,-1),e=e.slice(0,t)}if(94===e.charCodeAt(h)){if(!1===e.startsWith("script:has-text(",h+1)||41!==e.charCodeAt(e.length-1))return null;if(r=e.slice(h,e.length),void 0===ze(r))return null}else if(e.length-h>4&&43===e.charCodeAt(h)&&e.startsWith("+js(",h)){if((void 0===o||void 0===o.hostnames&&void 0===o.entities)&&!1===G(a,Me.unhide))return null;if(a=K(a,Me.scriptInject),r=e.slice(h+4,e.length-1),!1===G(a,Me.unhide)&&0===r.length)return null}else{r=e.slice(h);const t=i.classifySelector(r);if(t===i.SelectorType.Extended)a=K(a,Me.extended);else if(t===i.SelectorType.Invalid||!Ne(r))return null}if(void 0===o&&!0===G(a,Me.extended))return null;if(void 0!==r&&(ae(r)&&(a=K(a,Me.isUnicode)),!1===G(a,Me.scriptInject)&&!1===G(a,Me.remove)&&!1===G(a,Me.extended)&&!1===r.startsWith("^"))){const e=r.charCodeAt(0),t=r.charCodeAt(1),s=r.charCodeAt(2);!1===G(a,Me.scriptInject)&&(46===e&&Be(r)?a=K(a,Me.isClassSelector):35===e&&Be(r)?a=K(a,Me.isIdSelector):(97===e&&91===t&&104===s&&De(r,2)||91===e&&104===t&&De(r,1))&&(a=K(a,Me.isHrefSelector)))}return new $e({mask:a,rawLine:!0===t?s:void 0,selector:r,style:n,domains:o})}static deserialize(e){const t=e.getUint16(),s=G(t,Me.isUnicode),i=e.getUint8(),r=s?e.getUTF8():e.getCosmeticSelector();return new $e({mask:t,selector:r,domains:1&~i?void 0:Fe.deserialize(e),rawLine:2&~i?void 0:e.getRawCosmetic(),style:4&~i?void 0:e.getASCII()})}constructor({mask:e,selector:t,domains:s,rawLine:i,style:r}){this.mask=e,this.selector=t,this.domains=s,this.style=r,this.id=void 0,this.rawLine=i,this.scriptletDetails=void 0}isCosmeticFilter(){return!0}isNetworkFilter(){return!1}serialize(e){e.pushUint16(this.mask);const t=e.getPos();e.pushUint8(0),this.isUnicode()?e.pushUTF8(this.selector):e.pushCosmeticSelector(this.selector);let s=0;void 0!==this.domains&&(s|=1,this.domains.serialize(e)),void 0!==this.rawLine&&(s|=2,e.pushRawCosmetic(this.rawLine)),void 0!==this.style&&(s|=4,e.pushASCII(this.style)),e.setByte(t,s)}getSerializedSize(e){let t=3;return this.isUnicode()?t+=I(this.selector):t+=function(e,t){return!0===t?F(x().cosmeticSelector.getCompressedSize(e),!1):z(e)}(this.selector,e),void 0!==this.domains&&(t+=this.domains.getSerializedSize()),void 0!==this.rawLine&&(t+=function(e,t){return!0===t?F(x().cosmeticRaw.getCompressedSize(v.encode(e)),!1):I(e)}(this.rawLine,e)),void 0!==this.style&&(t+=z(this.style)),t}toString(){if(void 0!==this.rawLine)return this.rawLine;let e="";return void 0!==this.domains&&(void 0!==this.domains.parts?e+=this.domains.parts:e+="<hostnames>"),this.isUnhide()?e+="#@#":e+="##",this.isScriptInject()?(e+="+js(",e+=this.selector,e+=")"):e+=this.selector,this.hasCustomStyle()&&(e+=":style("+this.getStyle()+")"),e}match(e,t){return!1===this.hasHostnameConstraint()||!(!e&&this.hasHostnameConstraint())&&(void 0===this.domains||this.domains.match(0===e.length?y:fe(e,t),0===e.length?y:ue(e,t)))}getTokens(){const e=[];if(void 0!==this.domains){const{hostnames:t,entities:s}=this.domains;if(void 0!==t)for(const s of t)e.push(new Uint32Array([s]));if(void 0!==s)for(const t of s)e.push(new Uint32Array([t]))}if(0===e.length&&!1===this.isUnhide())if(this.isIdSelector()||this.isClassSelector()){let t=1;const s=this.selector;for(;t<s.length;t+=1){const e=s.charCodeAt(t);if(32===e||46===e||58===e||91===e)break}const i=new Uint32Array(1);i[0]=X(s,1,t),e.push(i)}else if(!0===this.isHrefSelector()){const t=this.getSelector();let s=t.indexOf("href");if(-1===s)return Ue;s+=4;let i=!1,r=!0;42===t.charCodeAt(s)?(i=!0,s+=1):94===t.charCodeAt(s)?s+=1:r=!1,s+=2;const o=t.indexOf('"',s);if(-1===o)return Ue;e.push(function(e,t,s){return $.reset(),se(e,t,s,$),$.slice()}(this.selector.slice(s,o),i,r))}return 0===e.length?Ue:e}parseScript(){if(void 0!==this.scriptletDetails)return this.scriptletDetails;const e=this.getSelector();if(0===e.length)return;const t=[];let s=0,i=-1,r=!1,o=!1,n=!1,a=!1,c=0,l=!1,h=!1;for(;s<e.length;s+=1){const d=e[s];!1===l&&(!0===r?'"'===d&&(r=!1):!0===o?"'"===d&&(o=!1):!0===n?"`"===d&&(n=!1):0!==c?"{"===d?c+=1:"}"===d?c-=1:'"'===d?r=!0:"'"===d?o=!0:"`"===d&&(n=!0):!0===a?"/"===d&&(a=!1):!1===h&&(" "===d||('"'===d&&e.indexOf('"',s+1)>0?r=!0:"'"===d&&e.indexOf("'",s+1)>0?o=!0:"`"===d&&e.indexOf("`",s+1)>0?n=!0:"{"===d&&e.indexOf("}",s+1)>0?c+=1:"/"===d&&e.indexOf("/",s+1)>0?a=!0:h=!0))),!1===l&&","===d&&!1===r&&!1===o&&!1===n&&!1===a&&(t.push(e.slice(i+1,s).trim()),i=s,h=!1),l="\\"===d&&!l}t.push(e.slice(i+1).trim());const d=t.slice(1).map((e=>{const t=e.charCodeAt(0);if(!(39===t&&e.endsWith("'")||34===t&&e.endsWith('"')||96===t&&e.endsWith("`")))return e;if(92===e.charCodeAt(e.length-2))return e;if(e.length>2)for(let s=1;s<e.length-1;s++)if(e.charCodeAt(s)===t&&92!==e.charCodeAt(s-1))return e;const s=e.substring(1,e.length-1);return 39===t?s.replace(je,"'"):34===t?s.replace(Pe,'"'):s.replace(Le,"`")})).map((e=>{const t=e.startsWith("{");let s=e.replace(Ee,",").replace(Oe,"\\");return t||(s=s.replace(He,",")),s}));return this.scriptletDetails={name:t[0],args:d},this.scriptletDetails}getScript(e){const t=this.parseScript();if(void 0===t)return;const{name:s,args:i}=t;let r=e(s);if(void 0!==r){for(let e=0;e<i.length;e+=1){const t=i[e].replace(/[.*+?^${}()|[\]\\]/g,"\\$&");r=r.replace(`{{${e+1}}}`,t)}return r}}hasHostnameConstraint(){return void 0!==this.domains}getId(){return void 0===this.id&&(this.id=function(e,t,s,i){let r=185407^e;if(void 0!==t)for(let e=0;e<t.length;e+=1)r=r*W^t.charCodeAt(e);if(void 0!==s&&(r=s.updateId(r)),void 0!==i)for(let e=0;e<i.length;e+=1)r=r*W^i.charCodeAt(e);return r>>>0}(this.mask,this.selector,this.domains,this.style)),this.id}hasCustomStyle(){return void 0!==this.style}getStyle(e=Te){return this.style||e}getStyleAttributeHash(){return`s${Y(this.getStyle())}`}getSelector(){return this.selector}getSelectorAST(){return i.parse(this.getSelector())}getExtendedSelector(){return ze(this.selector)}isExtended(){return G(this.mask,Me.extended)}isRemove(){return G(this.mask,Me.remove)}isUnhide(){return G(this.mask,Me.unhide)}isScriptInject(){return G(this.mask,Me.scriptInject)}isCSS(){return!1===this.isScriptInject()}isIdSelector(){return G(this.mask,Me.isIdSelector)}isClassSelector(){return G(this.mask,Me.isClassSelector)}isHrefSelector(){return G(this.mask,Me.isHrefSelector)}isUnicode(){return G(this.mask,Me.isUnicode)}isHtmlFiltering(){return this.getSelector().startsWith("^")}isGenericHide(){var e,t;return void 0===(null===(e=null==this?void 0:this.domains)||void 0===e?void 0:e.hostnames)&&void 0===(null===(t=null==this?void 0:this.domains)||void 0===t?void 0:t.entities)}}class We{constructor(){this.options=new Set,this.prefix=void 0,this.infix=void 0,this.suffix=void 0,this.redirect=void 0}blockRequestsWithType(e){if(this.options.has(e))throw new Error(`Already blocking type ${e}`);return this.options.add(e),this}images(){return this.blockRequestsWithType("image")}scripts(){return this.blockRequestsWithType("script")}frames(){return this.blockRequestsWithType("frame")}fonts(){return this.blockRequestsWithType("font")}medias(){return this.blockRequestsWithType("media")}styles(){return this.blockRequestsWithType("css")}redirectTo(e){if(void 0!==this.redirect)throw new Error(`Already redirecting: ${this.redirect}`);return this.redirect=`redirect=${e}`,this}urlContains(e){if(void 0!==this.infix)throw new Error(`Already matching pattern: ${this.infix}`);return this.infix=e,this}urlStartsWith(e){if(void 0!==this.prefix)throw new Error(`Already matching prefix: ${this.prefix}`);return this.prefix=`|${e}`,this}urlEndsWith(e){if(void 0!==this.suffix)throw new Error(`Already matching suffix: ${this.suffix}`);return this.suffix=`${e}|`,this}withHostname(e){if(void 0!==this.prefix)throw new Error(`Cannot match hostname if filter already has prefix: ${this.prefix}`);return this.prefix=`||${e}^`,this}toString(){const e=[];void 0!==this.prefix&&e.push(this.prefix),void 0!==this.infix&&e.push(this.infix),void 0!==this.suffix&&e.push(this.suffix);const t=["important"];if(0!==this.options.size)for(const e of this.options)t.push(e);return void 0!==this.redirect&&t.push(this.redirect),`${0===e.length?"*":e.join("*")}$${t.join(",")}`}}function qe(){return new We}const Ve=Y("http"),Ge=Y("https");var Ke;!function(e){e[e.fromDocument=1]="fromDocument",e[e.fromFont=2]="fromFont",e[e.fromHttp=4]="fromHttp",e[e.fromHttps=8]="fromHttps",e[e.fromImage=16]="fromImage",e[e.fromMedia=32]="fromMedia",e[e.fromObject=64]="fromObject",e[e.fromOther=128]="fromOther",e[e.fromPing=256]="fromPing",e[e.fromScript=512]="fromScript",e[e.fromStylesheet=1024]="fromStylesheet",e[e.fromSubdocument=2048]="fromSubdocument",e[e.fromWebsocket=4096]="fromWebsocket",e[e.fromXmlHttpRequest=8192]="fromXmlHttpRequest",e[e.firstParty=16384]="firstParty",e[e.thirdParty=32768]="thirdParty",e[e.isReplace=65536]="isReplace",e[e.isBadFilter=131072]="isBadFilter",e[e.isCSP=262144]="isCSP",e[e.isGenericHide=524288]="isGenericHide",e[e.isImportant=1048576]="isImportant",e[e.isSpecificHide=2097152]="isSpecificHide",e[e.isFullRegex=4194304]="isFullRegex",e[e.isRegex=8388608]="isRegex",e[e.isUnicode=16777216]="isUnicode",e[e.isLeftAnchor=33554432]="isLeftAnchor",e[e.isRightAnchor=67108864]="isRightAnchor",e[e.isException=134217728]="isException",e[e.isHostnameAnchor=268435456]="isHostnameAnchor",e[e.isRedirectRule=536870912]="isRedirectRule",e[e.isRedirect=1073741824]="isRedirect",e[e.isRemoveParam=-2147483648]="isRemoveParam"}(Ke||(Ke={}));const Ze=Ke.fromDocument|Ke.fromFont|Ke.fromImage|Ke.fromMedia|Ke.fromObject|Ke.fromOther|Ke.fromPing|Ke.fromScript|Ke.fromStylesheet|Ke.fromSubdocument|Ke.fromWebsocket|Ke.fromXmlHttpRequest,Xe={beacon:Ke.fromPing,document:Ke.fromDocument,cspviolationreport:Ke.fromOther,fedcm:Ke.fromScript,fetch:Ke.fromXmlHttpRequest,font:Ke.fromFont,image:Ke.fromImage,imageset:Ke.fromImage,json:Ke.fromScript,mainFrame:Ke.fromDocument,main_frame:Ke.fromDocument,media:Ke.fromMedia,object:Ke.fromObject,object_subrequest:Ke.fromObject,ping:Ke.fromPing,script:Ke.fromScript,stylesheet:Ke.fromStylesheet,subFrame:Ke.fromSubdocument,sub_frame:Ke.fromSubdocument,webSocket:Ke.fromWebsocket,websocket:Ke.fromWebsocket,xhr:Ke.fromXmlHttpRequest,xmlhttprequest:Ke.fromXmlHttpRequest,cspReport:Ke.fromOther,csp_report:Ke.fromOther,eventsource:Ke.fromOther,manifest:Ke.fromOther,other:Ke.fromOther,prefetch:Ke.fromOther,preflight:Ke.fromOther,signedexchange:Ke.fromOther,speculative:Ke.fromOther,texttrack:Ke.fromOther,web_manifest:Ke.fromOther,xml_dtd:Ke.fromOther,xslt:Ke.fromOther};function Ye(e){const t=[];return e.fromDocument()&&t.push("document"),e.fromImage()&&t.push("image"),e.fromMedia()&&t.push("media"),e.fromObject()&&t.push("object"),e.fromOther()&&t.push("other"),e.fromPing()&&t.push("ping"),e.fromScript()&&t.push("script"),e.fromStylesheet()&&t.push("stylesheet"),e.fromSubdocument()&&t.push("sub_frame"),e.fromWebsocket()&&t.push("websocket"),e.fromXmlHttpRequest()&&t.push("xhr"),e.fromFont()&&t.push("font"),t}function Je(e,t,s,i,r,o){let n=185407^e;if(void 0!==i&&(n=i.updateId(n)),void 0!==r&&(n=r.updateId(n)),void 0!==t)for(let e=0;e<t.length;e+=1)n=n*W^t.charCodeAt(e);if(void 0!==s)for(let e=0;e<s.length;e+=1)n=n*W^s.charCodeAt(e);if(void 0!==o)for(let e=0;e<o.length;e+=1)n=n*W^o.charCodeAt(e);return n>>>0}function Qe(e,t,s,i){return!0===i?new RegExp(e.slice(1,e.length-1),"i"):(e=(e=(e=e.replace(/([|.$+?{}()[\]\\])/g,"\\$1")).replace(/\*/g,".*")).replace(/\^/g,"(?:[^\\w\\d_.%-]|$)"),s&&(e=`${e}$`),t&&(e=`^${e}`),new RegExp(e))}function et(e,t,s){const i=t;for(;t<s;t++){const i=e.charCodeAt(t);if(61===i||44===i){s=t;break}}return[t,e.slice(i,s)]}function tt(e,t,s){let i=t,r="";for(;t<s;t++){const s=e.charCodeAt(t);if(92===s)r+=e.slice(i,t),i=++t;else if(44===s)break}return i-t!=0&&(r+=e.slice(i,t)),[t,r]}const st=new Set([102,110,114,116,118,48,94,36,92,46,42,43,63,40,41,91,93,123,125,124,47,100,68,119,87,115,83,98,66]);function it(e){return e>=48&&e<=57||e<=65&&e<=70||e>=97&&e<=102}function rt(e,t,s){const i=e.charCodeAt(t+1);return 44===i||47===i?[t+1,!1]:function(e,t){const s=e.charCodeAt(t+1);if(44===s||st.has(s))return[t+1,!0];if(99===s){const s=e.charCodeAt(t+2);if(s>=65&&s<=90||s>=97&&s<=122)return[t+2,!0]}if(120===s&&it(e.charCodeAt(t+2))&&it(e.charCodeAt(t+3)))return[t+3,!0];if(117===s)if(123===e.charCodeAt(t+2)){const s=e.indexOf("}",t+3),i=s-t+3;if(i>=1&&i<=6)return[s,!0]}else if(it(e.charCodeAt(t+2))&&it(e.charCodeAt(t+3))&&it(e.charCodeAt(t+4))&&it(e.charCodeAt(t+5)))return[t+5,!0];return[t+1,!1]}(e,t)}function ot(e,t,s){if(47!==e.charCodeAt(t++))return[s,void 0];const i=["","",""];let r=t,o=0;for(;t<s;t++){const s=e.charCodeAt(t);if(92===s){i[o]+=e.slice(r,t);const[s,n]=rt(e,t);!1===n&&++t,r=t,t=s}else if(47===s&&(t-r!=0&&(i[o]+=e.slice(r,t)),r=t+1,2==++o))break}const n=e.indexOf(",",t);return-1!==n&&(s=n),i[2]=e.slice(r,s),[t=s,i]}function nt(e){const[,t]=ot(e,0,e.length);if(void 0===t)return null;try{return[new RegExp(t[0],t[2]),t[1]]}catch(e){return null}}const at=new RegExp("");class ct{static parse(e,t=!1){let s,i,r,o,n=Ke.thirdParty|Ke.firstParty|Ke.fromHttps|Ke.fromHttp,a=0,c=Ze,l=0,h=e.length;64===e.charCodeAt(0)&&64===e.charCodeAt(1)&&(l+=2,n=K(n,Ke.isException));const d=function(e,t){let s=e.lastIndexOf(t);if(-1===s)return-1;for(;s>0&&92===e.charCodeAt(s-1);)s=e.lastIndexOf(t,s-1);return s}(e,"$");if(-1!==d&&47!==e.charCodeAt(d+1)){let s,l;h=d;for(const t of function(e,t,s){const i=[];let r,o;for(;t<s;t++)if([t,r]=et(e,t,s),void 0!==r){if(61===e.charCodeAt(t)&&t++,"replace"===r){const i=ot(e,t,s);o=void 0===i[1]?"":e.slice(t,i[0]),t=i[0]}else[t,o]=tt(e,t,s);i.push([r,o])}return i}(e,d+1,e.length)){const e=126===t[0].charCodeAt(0),i=!0===e?t[0].slice(1):t[0],r=t[1];switch(i){case"to":null!=s||(s=new Set),null!=l||(l=new Set);for(const e of r.split("|"))e.startsWith("~")?l.add(e.slice(1)):s.add(e);break;case"denyallow":null!=l||(l=new Set);for(const e of r.split("|"))l.add(e);break;case"domain":case"from":null!=s||(s=new Set);for(const e of r.split("|"))s.add(e);break;case"badfilter":n=K(n,Ke.isBadFilter);break;case"important":if(e)return null;n=K(n,Ke.isImportant);break;case"match-case":if(e)return null;break;case"3p":case"third-party":n=Z(n,e?Ke.thirdParty:Ke.firstParty);break;case"1p":case"first-party":n=Z(n,e?Ke.firstParty:Ke.thirdParty);break;case"redirect-rule":case"redirect":{if(e)return null;if(0===r.length)return null;const t=r.lastIndexOf(":");if(0===t)return null;if(-1!==t&&(!0===isNaN(Number(r.slice(t+1)))||t+1===r.length))return null;if(n=K(n,Ke.isRedirect),"redirect-rule"===i&&(n=K(n,Ke.isRedirectRule)),void 0!==o)return null;o=r;break}case"csp":if(e)return null;if(n=K(n,Ke.isCSP),r.length>0){if(void 0!==o)return null;o=r}break;case"ehide":case"elemhide":if(e)return null;n=K(n,Ke.isGenericHide),n=K(n,Ke.isSpecificHide);break;case"shide":case"specifichide":if(e)return null;n=K(n,Ke.isSpecificHide);break;case"ghide":case"generichide":if(e)return null;n=K(n,Ke.isGenericHide);break;case"inline-script":if(e||void 0!==o)return null;n=K(n,Ke.isCSP),o="script-src 'self' 'unsafe-eval' http: https: data: blob: mediastream: filesystem:";break;case"inline-font":if(e||void 0!==o)return null;n=K(n,Ke.isCSP),o="font-src 'self' 'unsafe-eval' http: https: data: blob: mediastream: filesystem:";break;case"replace":case"content":if(e||(0===r.length?!1===G(n,Ke.isException):null===nt(r))||void 0!==o)return null;n=K(n,Ke.isReplace),o=r;break;case"removeparam":if(e||r.startsWith("/")||void 0!==o)return null;n=K(n,Ke.isRemoveParam),o=r;break;default:{let t=0;switch(i){case"all":if(e)return null;break;case"image":t=Ke.fromImage;break;case"media":t=Ke.fromMedia;break;case"object":case"object-subrequest":t=Ke.fromObject;break;case"other":t=Ke.fromOther;break;case"ping":case"beacon":t=Ke.fromPing;break;case"script":t=Ke.fromScript;break;case"css":case"stylesheet":t=Ke.fromStylesheet;break;case"frame":case"subdocument":t=Ke.fromSubdocument;break;case"xhr":case"xmlhttprequest":t=Ke.fromXmlHttpRequest;break;case"websocket":t=Ke.fromWebsocket;break;case"font":t=Ke.fromFont;break;case"doc":case"document":t=Ke.fromDocument;break;default:return null}e?c=Z(c,t):a=K(a,t);break}}}if(void 0!==s&&0!==s.size&&(i=Fe.parse(s,{delimiter:"|",debug:t}),void 0===i))return null;if(void 0!==l&&0!==l.size){if(void 0===s||0===s.size)return null;if(r=Fe.parse(l,{delimiter:"|",debug:t}),void 0===r)return null}}let u;if(n=K(n,0===a?c:c===Ze?a:a&c),h-l>=2&&47===e.charCodeAt(l)&&47===e.charCodeAt(h-1)){u=e.slice(l,h);try{Qe(u,!1,!1,!0)}catch(e){return null}n=K(n,Ke.isFullRegex)}else{if(h>0&&124===e.charCodeAt(h-1)&&(n=K(n,Ke.isRightAnchor),h-=1),l<h&&124===e.charCodeAt(l)&&(l<h-1&&124===e.charCodeAt(l+1)?(n=K(n,Ke.isHostnameAnchor),l+=2):(n=K(n,Ke.isLeftAnchor),l+=1)),G(n,Ke.isHostnameAnchor)){let t=l;for(;t<h&&!0===(Q(f=e.charCodeAt(t))||ee(f)||95===f||45===f||46===f);)t+=1;if(t===h)s=e.slice(l,h),l=h;else{s=e.slice(l,t),l=t;const i=e.charCodeAt(t);94===i?h-l==1?(l=h,n=K(n,Ke.isRightAnchor)):(n=K(n,Ke.isRegex),n=K(n,Ke.isLeftAnchor)):n=K(n,42===i?Ke.isRegex:Ke.isLeftAnchor)}}h-l>0&&42===e.charCodeAt(h-1)&&(h-=1),!1===G(n,Ke.isHostnameAnchor)&&h-l>0&&42===e.charCodeAt(l)&&(n=Z(n,Ke.isLeftAnchor),l+=1),G(n,Ke.isLeftAnchor)&&(h-l==5&&e.startsWith("ws://",l)?(n=K(n,Ke.fromWebsocket),n=Z(n,Ke.isLeftAnchor),n=Z(n,Ke.fromHttp),n=Z(n,Ke.fromHttps),l=h):h-l==7&&e.startsWith("http://",l)?(n=K(n,Ke.fromHttp),n=Z(n,Ke.fromHttps),n=Z(n,Ke.isLeftAnchor),l=h):h-l==8&&e.startsWith("https://",l)?(n=K(n,Ke.fromHttps),n=Z(n,Ke.fromHttp),n=Z(n,Ke.isLeftAnchor),l=h):h-l==8&&e.startsWith("http*://",l)&&(n=K(n,Ke.fromHttps),n=K(n,Ke.fromHttp),n=Z(n,Ke.isLeftAnchor),l=h)),h-l>0&&(u=e.slice(l,h).toLowerCase(),n=lt(n,Ke.isUnicode,ae(u)),!1===G(n,Ke.isRegex)&&(n=lt(n,Ke.isRegex,function(e,t,s){const i=e.indexOf("^",t);if(-1!==i&&i<s)return!0;const r=e.indexOf("*",t);return-1!==r&&r<s}(u,0,u.length)))),void 0!==s&&(s=s.toLowerCase(),ae(s)&&(n=lt(n,Ke.isUnicode,!0),s=Se(s)))}var f;return new ct({filter:u,hostname:s,mask:n,domains:i,denyallow:r,optionValue:o,rawLine:!0===t?e:void 0,regex:void 0})}static deserialize(e){const t=e.getUint32(),s=e.getUint8(),i=G(t,Ke.isUnicode);return new ct({mask:t,filter:1&~s?void 0:i?e.getUTF8():e.getNetworkFilter(),hostname:2&~s?void 0:e.getNetworkHostname(),domains:4&~s?void 0:Fe.deserialize(e),rawLine:8&~s?void 0:e.getRawNetwork(),denyallow:16&~s?void 0:Fe.deserialize(e),optionValue:32&~s?void 0:G(t,Ke.isCSP)?e.getNetworkCSP():G(t,Ke.isRedirect)?e.getNetworkRedirect():e.getUTF8(),regex:void 0})}constructor({filter:e,hostname:t,mask:s,domains:i,denyallow:r,optionValue:o,rawLine:n,regex:a}){this.filter=e,this.hostname=t,this.mask=K(s,0),this.domains=i,this.denyallow=r,this.optionValue=o,this.rawLine=n,this.id=void 0,this.regex=a}get csp(){if(this.isCSP())return this.optionValue}get redirect(){if(this.isRedirect())return this.optionValue}get removeparam(){if(this.isRemoveParam())return this.optionValue}isCosmeticFilter(){return!1}isNetworkFilter(){return!0}match(e){return function(e,t){if(!1===e.isCptAllowed(t.type)||!0===t.isHttps&&!1===e.fromHttps()||!0===t.isHttp&&!1===e.fromHttp()||!1===e.firstParty()&&!0===t.isFirstParty||!1===e.thirdParty()&&!0===t.isThirdParty)return!1;if(void 0!==e.domains&&!1===e.domains.match(t.sourceHostnameHashes,t.sourceEntityHashes))return!1;if(void 0!==e.denyallow&&!0===e.denyallow.match(t.getHostnameHashes(),t.getEntityHashes()))return!1;return!0}(this,e)&&function(e,t){const s=e.getFilter(),i=t.normalizedUrl;if(!0===e.isHostnameAnchor()){const r=e.getHostname();if(!1===function(e,t,s){if(0===e.length)return!0;if(e.length>t.length)return!1;if(e.length===t.length)return e===t;const i=t.indexOf(e);if(-1===i)return!1;if(0===i)return!0===s||46===t.charCodeAt(e.length)||46===e.charCodeAt(e.length-1);if(t.length===i+e.length)return 46===t.charCodeAt(i-1)||46===e.charCodeAt(0);return!(!0!==s&&46!==t.charCodeAt(e.length)&&46!==e.charCodeAt(e.length-1)||46!==t.charCodeAt(i-1)&&46!==e.charCodeAt(0))}(r,t.hostname,void 0!==e.filter&&42===e.filter.charCodeAt(0)))return!1;if(e.isRegex())return e.getRegex().test(i.slice(i.indexOf(r)+r.length));if(e.isRightAnchor()&&e.isLeftAnchor()){return s===i.slice(i.indexOf(r)+r.length)}if(e.isRightAnchor()){const o=t.hostname;return!1===e.hasFilter()?r.length===o.length||o.endsWith(r):i.endsWith(s)}return e.isLeftAnchor()?i.startsWith(s,i.indexOf(r)+r.length):!1===e.hasFilter()||-1!==i.indexOf(s,i.indexOf(r)+r.length)}if(e.isRegex())return e.getRegex().test(i);if(e.isLeftAnchor()&&e.isRightAnchor())return i===s;if(e.isLeftAnchor())return i.startsWith(s);if(e.isRightAnchor())return i.endsWith(s);if(!1===e.hasFilter())return!0;return-1!==i.indexOf(s)}(this,e)}serialize(e){e.pushUint32(this.mask);const t=e.getPos();e.pushUint8(0);let s=0;void 0!==this.filter&&(s|=1,this.isUnicode()?e.pushUTF8(this.filter):e.pushNetworkFilter(this.filter)),void 0!==this.hostname&&(s|=2,e.pushNetworkHostname(this.hostname)),void 0!==this.domains&&(s|=4,this.domains.serialize(e)),void 0!==this.rawLine&&(s|=8,e.pushRawNetwork(this.rawLine)),void 0!==this.denyallow&&(s|=16,this.denyallow.serialize(e)),void 0!==this.optionValue&&(s|=32,this.isCSP()?e.pushNetworkCSP(this.optionValue):this.isRedirect()?e.pushNetworkRedirect(this.optionValue):e.pushUTF8(this.optionValue)),e.setByte(t,s)}getSerializedSize(e){let t=5;return void 0!==this.filter&&(!0===this.isUnicode()?t+=I(this.filter):t+=function(e,t){return!0===t?F(x().networkFilter.getCompressedSize(e),!1):z(e)}(this.filter,e)),void 0!==this.hostname&&(t+=function(e,t){return!0===t?F(x().networkHostname.getCompressedSize(e),!1):z(e)}(this.hostname,e)),void 0!==this.domains&&(t+=this.domains.getSerializedSize()),void 0!==this.rawLine&&(t+=function(e,t){return!0===t?F(x().networkRaw.getCompressedSize(v.encode(e)),!1):I(e)}(this.rawLine,e)),void 0!==this.denyallow&&(t+=this.denyallow.getSerializedSize()),void 0!==this.optionValue&&(this.isCSP()?t+=function(e,t){return!0===t?F(x().networkCSP.getCompressedSize(e),!1):z(e)}(this.optionValue,e):this.isRedirect()?t+=function(e,t){return!0===t?F(x().networkRedirect.getCompressedSize(e),!1):z(e)}(this.optionValue,e):t+=I(this.optionValue)),t}toString(e){if(void 0!==this.rawLine)return this.rawLine;let t="";this.isException()&&(t+="@@"),this.isHostnameAnchor()?t+="||":this.fromHttp()!==this.fromHttps()?this.fromHttp()?t+="|http://":t+="|https://":this.isLeftAnchor()&&(t+="|"),this.hasHostname()&&(t+=this.getHostname(),t+="^"),this.isFullRegex()?t+=`/${this.getRegex().source}/`:this.isRegex()?t+=this.getRegex().source:t+=this.getFilter(),this.isRightAnchor()&&"^"!==t[t.length-1]&&(t+="|");const s=[];if(!1===this.fromAny()){const e=V(this.getCptMask());if(V(Ze)-e<e)for(const e of function(e){const t=[];return!1===e.fromDocument()&&t.push("document"),!1===e.fromImage()&&t.push("image"),!1===e.fromMedia()&&t.push("media"),!1===e.fromObject()&&t.push("object"),!1===e.fromOther()&&t.push("other"),!1===e.fromPing()&&t.push("ping"),!1===e.fromScript()&&t.push("script"),!1===e.fromStylesheet()&&t.push("stylesheet"),!1===e.fromSubdocument()&&t.push("sub_frame"),!1===e.fromWebsocket()&&t.push("websocket"),!1===e.fromXmlHttpRequest()&&t.push("xhr"),!1===e.fromFont()&&t.push("font"),t}(this))s.push(`~${e}`);else for(const e of Ye(this))s.push(e)}this.isImportant()&&s.push("important"),this.isRedirectRule()?""===this.optionValue?s.push("redirect-rule"):s.push(`redirect-rule=${this.optionValue}`):this.isRedirect()&&(""===this.optionValue?s.push("redirect"):s.push(`redirect=${this.optionValue}`)),this.isCSP()&&s.push(`csp=${this.optionValue}`),this.isElemHide()&&s.push("elemhide"),this.isSpecificHide()&&s.push("specifichide"),this.isGenericHide()&&s.push("generichide"),this.firstParty()!==this.thirdParty()&&(this.firstParty()&&s.push("1p"),this.thirdParty()&&s.push("3p")),void 0!==this.domains&&(void 0!==this.domains.parts?s.push(`domain=${this.domains.parts}`):s.push("domain=<hashed>")),void 0!==this.denyallow&&(void 0!==this.denyallow.parts?s.push(`denyallow=${this.denyallow.parts}`):s.push("denyallow=<hashed>")),this.isBadFilter()&&s.push("badfilter");const i=this.removeparam;return void 0!==i&&(i.length>0?s.push(`removeparam=${i}`):s.push("removeparam")),s.length>0&&(t+="function"==typeof e?`$${s.map(e).join(",")}`:`$${s.join(",")}`),t}getIdWithoutBadFilter(){return Je(this.mask&~Ke.isBadFilter,this.filter,this.hostname,this.domains,this.denyallow,this.optionValue)}getId(){return void 0===this.id&&(this.id=Je(this.mask,this.filter,this.hostname,this.domains,this.denyallow,this.optionValue)),this.id}hasFilter(){return void 0!==this.filter}hasDomains(){return void 0!==this.domains}getMask(){return this.mask}getCptMask(){return this.getMask()&Ze}isRedirect(){return G(this.getMask(),Ke.isRedirect)}isRedirectRule(){return G(this.mask,Ke.isRedirectRule)}getRedirect(){var e;return null!==(e=this.optionValue)&&void 0!==e?e:""}isReplace(){return G(this.getMask(),Ke.isReplace)}isRemoveParam(){return G(this.getMask(),Ke.isRemoveParam)}getHtmlModifier(){var e;return 0===(null===(e=this.optionValue)||void 0===e?void 0:e.length)?null:nt(this.optionValue)}isHtmlFilteringRule(){return this.isReplace()}getRedirectResource(){const e=this.getRedirect(),t=e.lastIndexOf(":");return-1===t?e:e.slice(0,t)}getRedirectPriority(){const e=this.getRedirect(),t=e.lastIndexOf(":");return-1===t?0:Number(e.slice(t+1))}hasHostname(){return void 0!==this.hostname}getHostname(){return this.hostname||""}getFilter(){return this.filter||""}getRegex(){return void 0===this.regex&&(this.regex=void 0!==this.filter&&this.isRegex()?Qe(this.filter,this.isLeftAnchor(),this.isRightAnchor(),this.isFullRegex()):at),this.regex}getTokens(){if($.reset(),void 0!==this.domains&&void 0!==this.domains.hostnames&&void 0===this.domains.entities&&void 0===this.domains.notHostnames&&void 0===this.domains.notEntities&&1===this.domains.hostnames.length&&$.push(this.domains.hostnames[0]),!1===this.isFullRegex()){if(void 0!==this.filter){const e=!this.isRightAnchor(),t=!this.isLeftAnchor();!function(e,t,s,i){const r=Math.min(e.length,2*i.remaining());let o=!1,n=0,a=0,c=q;for(let s=0;s<r;s+=1){const r=e.charCodeAt(s);!0===te(r)?(!1===o&&(c=q,o=!0,a=s),c=c*W^r):(!0===o&&(o=!1,s-a>1&&42!==r&&42!==n&&(!1===t||0!==a)&&i.push(c>>>0)),n=r)}!1===s&&!0===o&&42!==n&&e.length-a>1&&!1===i.full()&&i.push(c>>>0)}(this.filter,t,e,$)}void 0!==this.hostname&&se(this.hostname,!1,void 0!==this.filter&&42===this.filter.charCodeAt(0),$)}else void 0!==this.filter&&function(e,t){let s=e.length-1,i=1,r=0;for(;i<s;i+=1){const t=e.charCodeAt(i);if(124===t)return;if(40===t||42===t||43===t||63===t||91===t||123===t||46===t&&92!==r||92===t&&ee(e.charCodeAt(i+1)))break;r=t}for(r=0;s>=i;s-=1){const t=e.charCodeAt(s);if(124===t)return;if(41===t||42===t||43===t||63===t||93===t||125===t||46===t&&92!==e.charCodeAt(s-1)||92===t&&ee(r))break;r=t}if(s<i){const s=94!==e.charCodeAt(1),i=36!==e.charCodeAt(e.length-1);se(e.slice(1,e.length-1),s,i,t)}else i>1&&se(e.slice(1,i),94!==e.charCodeAt(1),!0,t),s<e.length-1&&se(e.slice(s+1,e.length-1),!0,94!==e.charCodeAt(e.length-1),t)}(this.filter,$);if(!0===$.empty()&&void 0!==this.domains&&void 0!==this.domains.hostnames&&void 0===this.domains.entities&&void 0===this.domains.notHostnames&&void 0===this.domains.notEntities){const e=[];for(const t of this.domains.hostnames){const s=new Uint32Array(1);s[0]=t,e.push(s)}return e}if(!0===$.empty()&&!1===this.fromAny()){const e=Ye(this);if(0!==e.length){const t=[];for(const s of e){const e=new Uint32Array(1);e[0]=le[s],t.push(e)}return t}}return!0===this.fromHttp()&&!1===this.fromHttps()?$.push(Ve):!0===this.fromHttps()&&!1===this.fromHttp()&&$.push(Ge),[$.slice()]}isCptAllowed(e){const t=Xe[e];return void 0!==t?G(this.mask,t):this.fromAny()}isException(){return G(this.mask,Ke.isException)}isHostnameAnchor(){return G(this.mask,Ke.isHostnameAnchor)}isRightAnchor(){return G(this.mask,Ke.isRightAnchor)}isLeftAnchor(){return G(this.mask,Ke.isLeftAnchor)}isImportant(){return G(this.mask,Ke.isImportant)}isFullRegex(){return G(this.mask,Ke.isFullRegex)}isRegex(){return G(this.mask,Ke.isRegex)||G(this.mask,Ke.isFullRegex)}isPlain(){return!this.isRegex()}isCSP(){return G(this.mask,Ke.isCSP)}isElemHide(){return this.isSpecificHide()&&this.isGenericHide()}isSpecificHide(){return G(this.mask,Ke.isSpecificHide)}isGenericHide(){return G(this.mask,Ke.isGenericHide)}isBadFilter(){return G(this.mask,Ke.isBadFilter)}isUnicode(){return G(this.mask,Ke.isUnicode)}fromAny(){return this.getCptMask()===Ze}thirdParty(){return G(this.mask,Ke.thirdParty)}firstParty(){return G(this.mask,Ke.firstParty)}fromImage(){return G(this.mask,Ke.fromImage)}fromMedia(){return G(this.mask,Ke.fromMedia)}fromObject(){return G(this.mask,Ke.fromObject)}fromOther(){return G(this.mask,Ke.fromOther)}fromPing(){return G(this.mask,Ke.fromPing)}fromScript(){return G(this.mask,Ke.fromScript)}fromStylesheet(){return G(this.mask,Ke.fromStylesheet)}fromDocument(){return G(this.mask,Ke.fromDocument)}fromSubdocument(){return G(this.mask,Ke.fromSubdocument)}fromWebsocket(){return G(this.mask,Ke.fromWebsocket)}fromHttp(){return G(this.mask,Ke.fromHttp)}fromHttps(){return G(this.mask,Ke.fromHttps)}fromXmlHttpRequest(){return G(this.mask,Ke.fromXmlHttpRequest)}fromFont(){return G(this.mask,Ke.fromFont)}}function lt(e,t,s){return!0===s?K(e,t):Z(e,t)}class ht extends Map{}var dt;function ut(e){return e.length<6||33!==e.charCodeAt(0)||35!==e.charCodeAt(1)?dt.INVALID:e.startsWith("!#if ")?dt.BEGIF:e.startsWith("!#else")?dt.ELSE:e.startsWith("!#endif")?dt.ENDIF:dt.INVALID}!function(e){e[e.INVALID=0]="INVALID",e[e.BEGIF=1]="BEGIF",e[e.ELSE=2]="ELSE",e[e.ENDIF=3]="ENDIF"}(dt||(dt={}));const ft=/(!|&&|\|\||\(|\)|[a-zA-Z0-9_]+)/g,pt=/^[a-zA-Z0-9_]+$/,mt={"!":2,"&&":1,"||":0},gt=e=>Object.prototype.hasOwnProperty.call(mt,e),yt=(e,t)=>"true"===e&&!t.has("true")||!("false"===e&&!t.has("false"))&&!!t.get(e),wt=(e,t)=>{if(0===e.length)return!1;if((e=>pt.test(e))(e))return"!"===e[0]?!yt(e.slice(1),t):yt(e,t);const s=(e=>e.match(ft))(e);if(!s||0===s.length)return!1;if(e.length!==s.reduce(((e,t)=>e+t.length),0))return!1;const i=[],r=[];for(const e of s)if("("===e)r.push(e);else if(")"===e){for(;0!==r.length&&"("!==r[r.length-1];)i.push(r.pop());if(0===r.length)return!1;r.pop()}else if(gt(e)){for(;r.length&&gt(r[r.length-1])&&mt[e]<=mt[r[r.length-1]];)i.push(r.pop());r.push(e)}else i.push(yt(e,t));if("("===r[0]||")"===r[0])return!1;for(;0!==r.length;)i.push(r.pop());for(const e of i)if(!0===e||!1===e)r.push(e);else if("!"===e)r.push(!r.pop());else if(gt(e)){const t=r.pop(),s=r.pop();"&&"===e?r.push(s&&t):r.push(s||t)}return!0===r[0]};class vt{static getCondition(e){return e.slice(5).replace(/\s/g,"")}static parse(e,t){return new this({condition:vt.getCondition(e),filterIDs:t})}static deserialize(e){const t=e.getUTF8(),s=new Set;for(let t=0,i=e.getUint32();t<i;t++)s.add(e.getUint32());return new this({condition:t,filterIDs:s})}constructor({condition:e,filterIDs:t=new Set}){this.condition=e,this.filterIDs=t}evaluate(e){return wt(this.condition,e)}serialize(e){e.pushUTF8(this.condition),e.pushUint32(this.filterIDs.size);for(const t of this.filterIDs)e.pushUint32(t)}getSerializedSize(){let e=I(this.condition);return e+=4*(1+this.filterIDs.size),e}}var bt;function xt(t,{extendedNonSupportedTypes:s=!1}={}){if(0===t.length||1===t.length)return s?e.FilterType.NOT_SUPPORTED_EMPTY:e.FilterType.NOT_SUPPORTED;const i=t.charCodeAt(0),r=t.charCodeAt(1);if(33===i||35===i&&r<=32||91===i&&t.startsWith("[Adblock"))return s?e.FilterType.NOT_SUPPORTED_COMMENT:e.FilterType.NOT_SUPPORTED;const o=t.charCodeAt(t.length-1);if(36===i&&36!==r&&64!==r||38===i||42===i||45===i||46===i||47===i||58===i||61===i||63===i||64===i||95===i||124===i||124===o)return e.FilterType.NETWORK;const n=t.indexOf("$");if(-1!==n&&n!==t.length-1){const i=n+1,r=t.charCodeAt(i);if(36===r||64===r&&t.startsWith("@$",i))return s?e.FilterType.NOT_SUPPORTED_ADGUARD:e.FilterType.NOT_SUPPORTED}const a=t.indexOf("#");if(-1!==a&&a!==t.length-1){const i=a+1,r=t.charCodeAt(i);if(35===r||64===r&&t.startsWith("@#",i))return e.FilterType.COSMETIC;if(64===r&&(t.startsWith("@$#",i)||t.startsWith("@%#",i)||t.startsWith("@?#",i))||37===r&&t.startsWith("%#",i)||36===r&&(t.startsWith("$#",i)||t.startsWith("$?#",i))||63===r&&t.startsWith("?#",i))return s?e.FilterType.NOT_SUPPORTED_ADGUARD:e.FilterType.NOT_SUPPORTED}return e.FilterType.NETWORK}function kt(t){const s=xt(t);return s===e.FilterType.NETWORK?ct.parse(t,!0):s===e.FilterType.COSMETIC?$e.parse(t,!0):null}function St(t,s=new R){s=new R(s);const i=[],r=[],o=[],n=t.split("\n"),a=[],c=[];for(let t=0;t<n.length;t+=1){let l=n[t];if(0!==l.length&&l.charCodeAt(0)<=32&&(l=l.trim()),l.length>2)for(;t<n.length-1&&92===l.charCodeAt(l.length-1)&&32===l.charCodeAt(l.length-2);){l=l.slice(0,-2);const e=n[t+1];if(!(e.length>4&&32===e.charCodeAt(0)&&32===e.charCodeAt(1)&&32===e.charCodeAt(2)&&32===e.charCodeAt(3)&&32!==e.charCodeAt(4)))break;l+=e.slice(4),t+=1}0!==l.length&&l.charCodeAt(l.length-1)<=32&&(l=l.trim());const h=xt(l,{extendedNonSupportedTypes:!0});if(h===e.FilterType.NETWORK&&!0===s.loadNetworkFilters){const e=ct.parse(l,s.debug);null!==e?(i.push(e),c.length>0&&c[c.length-1].filterIDs.add(e.getId())):o.push({lineNumber:t,filter:l,filterType:h})}else if(h===e.FilterType.COSMETIC&&!0===s.loadCosmeticFilters){const i=$e.parse(l,s.debug);null!==i?!0!==s.loadGenericCosmeticsFilters&&!1!==i.isGenericHide()||(r.push(i),c.length>0&&c[c.length-1].filterIDs.add(i.getId())):o.push({lineNumber:t,filter:l,filterType:e.FilterType.COSMETIC})}else if(s.loadPreprocessors){const s=ut(l);if(s===dt.BEGIF)c.length>0?c.push(new vt({condition:`(${c[c.length-1].condition})&&(${vt.getCondition(l)})`})):c.push(vt.parse(l));else if((s===dt.ENDIF||s===dt.ELSE)&&c.length>0){const e=c.pop();a.push(e),s===dt.ELSE&&c.push(new vt({condition:`!(${e.condition})`}))}else h===e.FilterType.NOT_SUPPORTED_ADGUARD&&o.push({lineNumber:t,filter:l,filterType:h})}else h===e.FilterType.NOT_SUPPORTED_ADGUARD&&o.push({lineNumber:t,filter:l,filterType:h})}return{networkFilters:i,cosmeticFilters:r,preprocessors:a.filter((e=>e.filterIDs.size>0)),notSupportedFilters:o}}function Ft(e,t){const{networkFilters:s,cosmeticFilters:i,preprocessors:r}=St(e,t);return{filters:[].concat(s).concat(i),preprocessors:r}}function zt(e){if(null===e)return!1;if("object"!=typeof e)return!1;const{name:t,aliases:s,body:i,contentType:r}=e;return"string"==typeof t&&(!(!Array.isArray(s)||!s.every((e=>"string"==typeof e)))&&("string"==typeof i&&"string"==typeof r))}function It(e){if(null===e)return!1;if("object"!=typeof e)return!1;const{name:t,aliases:s,body:i,dependencies:r,executionWorld:o,requiresTrust:n}=e;return"string"==typeof t&&(!(!Array.isArray(s)||!s.every((e=>"string"==typeof e)))&&("string"==typeof i&&(!(!Array.isArray(r)||!r.every((e=>"string"==typeof e)))&&((void 0===o||"MAIN"===o||"ISOLATED"===o)&&(void 0===n||"boolean"==typeof n)))))}e.FilterType=void 0,(bt=e.FilterType||(e.FilterType={}))[bt.NOT_SUPPORTED=0]="NOT_SUPPORTED",bt[bt.NETWORK=1]="NETWORK",bt[bt.COSMETIC=2]="COSMETIC",bt[bt.NOT_SUPPORTED_EMPTY=100]="NOT_SUPPORTED_EMPTY",bt[bt.NOT_SUPPORTED_COMMENT=101]="NOT_SUPPORTED_COMMENT",bt[bt.NOT_SUPPORTED_ADGUARD=102]="NOT_SUPPORTED_ADGUARD";class At{static deserialize(e){const t=e.getASCII(),s=[],i=[];for(let t=0,i=e.getUint16();t<i;t++){const t=e.getASCII(),i=[];for(let t=0,s=e.getUint16();t<s;t++)i.push(e.getASCII());s.push({name:t,aliases:i,body:e.getUTF8(),contentType:e.getASCII()})}for(let t=0,s=e.getUint16();t<s;t++){const t=e.getASCII(),s=[];for(let t=0,i=e.getUint16();t<i;t++)s.push(e.getASCII());const r=e.getUTF8(),o=e.getBool(),n=e.getBool(),a=e.getBool(),c=e.getBool(),l=[];for(let t=0,s=e.getUint16();t<s;t++)l.push(e.getASCII());const h={name:t,aliases:s,body:r,dependencies:l};o&&(h.executionWorld=!0===n?"ISOLATED":"MAIN"),a&&(h.requiresTrust=c),i.push(h)}return new At({checksum:t,scriptlets:i,resources:s})}static parse(e,{checksum:t}){const s=JSON.parse(e);if(null===s||"object"!=typeof s)throw new Error("Cannot parse resources.json");const{scriptlets:i,redirects:r}=s,o=[];if(Array.isArray(r))for(const e of r){if(!zt(e))throw new Error(`Cannot parse redirect resource: ${JSON.stringify(e)}`);o.push(e)}const n=[];if(Array.isArray(i))for(const e of i){if(!It(e))throw new Error(`Cannot parse scriptlet: ${JSON.stringify(e)}`);n.push(e)}return new At({checksum:t,scriptlets:n,resources:o})}static copy(e){const t=e.checksum,s=[],i=[];for(const t of e.resources)s.push(structuredClone(t));for(const t of e.scriptlets)i.push(structuredClone(t));return new this({checksum:t,resources:s,scriptlets:i})}constructor({checksum:e="",resources:t=[],scriptlets:s=[]}={}){this.checksum=e,this.resources=t,this.scriptlets=s,this.scriptletsCache=new Map,this.resourcesByName=new Map,this.scriptletsByName=new Map,this.updateAliases()}updateAliases(){this.scriptletsCache.clear(),this.resourcesByName.clear(),this.scriptletsByName.clear();for(const e of this.resources)for(const t of[e.name,...e.aliases]){if(this.resourcesByName.has(t))throw new Error(`Resource with a name or alias "${t}" already exists`);this.resourcesByName.set(t,e)}for(const e of this.scriptlets)for(const t of[e.name,...e.aliases]){if(this.scriptletsByName.has(t))throw new Error(`Scriptlet with a name or alias "${t}" already exists`);this.scriptletsByName.set(t,e)}for(const e of this.scriptlets)for(const t of e.dependencies)if(!this.scriptletsByName.has(t))throw new Error(`Scriptlet with a name or alias "${e.name}" has a missing depencency "${t}"`)}getResource(e){let t=this.resourcesByName.get(e);if(void 0===t){const s=e.lastIndexOf(".");t=n.getResourceForMime(-1===s?e:e.slice(s))}const{contentType:s,body:i}=t;let r;var o;return r=-1!==t.contentType.indexOf(";")?`data:${s},${i}`:`data:${s};base64,${o=i,"undefined"!=typeof btoa?btoa(o):"undefined"!=typeof Buffer?Buffer.from(o).toString("base64"):o}`,{filename:t.name,body:i,contentType:s,dataUrl:r}}getScriptlet(e){const t=this.getRawScriptlet(e);if(void 0===t)return this.getSurrogate(e);let s=this.scriptletsCache.get(t.name);if(void 0!==s){if(0===s.length)return;return s}const i=this.getScriptletDependencies(t);return s=((e,t=[])=>["if (typeof scriptletGlobals === 'undefined') { var scriptletGlobals = {}; }",...t,`(${e})(...[\`{{1}}\`,\`{{2}}\`,\`{{3}}\`,\`{{4}}\`,\`{{5}}\`,\`{{6}}\`,\`{{7}}\`,\`{{8}}\`,\`{{9}}\`,\`{{10}}\`].filter((a,i) => a !== '{{'+(i+1)+'}}').map((a) => decodeURIComponent(a)))`].join(";"))(t.body,i),this.scriptletsCache.set(t.name,s),s}getSurrogate(e){const t=this.resourcesByName.get(e.endsWith(".js")?e:`${e}.js`);if(void 0!==t&&"application/javascript"===t.contentType)return t.body}getScriptletCanonicalName(e){var t;return null===(t=this.getRawScriptlet(e))||void 0===t?void 0:t.name}getRawScriptlet(e){if(!e.endsWith(".fn"))return this.scriptletsByName.get(e.endsWith(".js")?e:`${e}.js`)}getScriptletDependencies(e){const t=new Map,s=[...e.dependencies];for(;s.length>0;){const e=s.pop();if(t.has(e))continue;const i=this.scriptletsByName.get(e);t.set(e,i.body),s.push(...i.dependencies)}return Array.from(t.values())}getSerializedSize(){let e=z(this.checksum);e+=2;for(const{name:t,aliases:s,body:i,contentType:r}of this.resources)e+=z(t),e+=s.reduce(((e,t)=>e+z(t)),2),e+=I(i),e+=z(r);e+=2;for(const{name:t,aliases:s,body:i,dependencies:r}of this.scriptlets)e+=z(t),e+=s.reduce(((e,t)=>e+z(t)),2),e+=I(i),e+=1,e+=1,e+=1,e+=1,e+=r.reduce(((e,t)=>e+z(t)),2);return e}serialize(e){e.pushASCII(this.checksum),e.pushUint16(this.resources.length);for(const{name:t,aliases:s,body:i,contentType:r}of this.resources){e.pushASCII(t),e.pushUint16(s.length);for(const t of s)e.pushASCII(t);e.pushUTF8(i),e.pushASCII(r)}e.pushUint16(this.scriptlets.length);for(const{name:t,aliases:s,body:i,dependencies:r,executionWorld:o,requiresTrust:n}of this.scriptlets){e.pushASCII(t),e.pushUint16(s.length);for(const t of s)e.pushASCII(t);e.pushUTF8(i),e.pushBool(void 0!==o),e.pushBool("ISOLATED"===o),e.pushBool(void 0!==n),e.pushBool(!0===n),e.pushUint16(r.length),r.forEach((t=>e.pushASCII(t)))}}}const Ct=new Uint32Array(0);function Rt(e){return`(?:${e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")})`}function Ut(e,t,s){let i=e.get(t);void 0===i&&(i=[],e.set(t,i)),i.push(s)}function Tt(e,t){const s=new Map;for(const i of e)Ut(s,t(i),i);return Array.from(s.values())}function Et(e,t){const s=[],i=[];for(const r of e)t(r)?s.push(r):i.push(r);return{negative:i,positive:s}}const Ot=[{description:"Remove duplicated filters by ID",fusion:e=>e[0],groupByCriteria:e=>""+e.getId(),select:()=>!0},{description:"Group idential filter with same mask but different domains in single filters",fusion:e=>{const t=[],s=new Set,i=new Set,r=new Set,o=new Set;for(const{domains:n}of e)if(void 0!==n){if(void 0!==n.parts&&t.push(n.parts),void 0!==n.hostnames)for(const e of n.hostnames)s.add(e);if(void 0!==n.entities)for(const e of n.entities)r.add(e);if(void 0!==n.notHostnames)for(const e of n.notHostnames)i.add(e);if(void 0!==n.notEntities)for(const e of n.notEntities)o.add(e)}return new ct(Object.assign({},e[0],{domains:new Fe({hostnames:0!==s.size?new Uint32Array(s).sort():void 0,entities:0!==r.size?new Uint32Array(r).sort():void 0,notHostnames:0!==i.size?new Uint32Array(i).sort():void 0,notEntities:0!==o.size?new Uint32Array(o).sort():void 0,parts:0!==t.length?t.join(","):void 0}),rawLine:void 0!==e[0].rawLine?e.map((({rawLine:e})=>e)).join(" <+> "):void 0}))},groupByCriteria:e=>{var t;return e.getHostname()+e.getFilter()+e.getMask()+(null!==(t=e.optionValue)&&void 0!==t?t:"")},select:e=>!e.isCSP()&&void 0===e.denyallow&&void 0!==e.domains},{description:"Group simple patterns, into a single filter",fusion:e=>{const t=[];for(const s of e)s.isRegex()?t.push(`(?:${s.getRegex().source})`):s.isRightAnchor()?t.push(`${Rt(s.getFilter())}$`):s.isLeftAnchor()?t.push(`^${Rt(s.getFilter())}`):t.push(Rt(s.getFilter()));return new ct(Object.assign({},e[0],{mask:K(e[0].mask,Ke.isRegex),rawLine:void 0!==e[0].rawLine?e.map((({rawLine:e})=>e)).join(" <+> "):void 0,regex:new RegExp(t.join("|"))}))},groupByCriteria:e=>""+(e.getMask()&~Ke.isRegex&~Ke.isFullRegex),select:e=>void 0===e.domains&&void 0===e.denyallow&&!e.isHostnameAnchor()&&!e.isRedirect()&&!e.isCSP()}];function Ht(e){return e}function jt(e){return e}function Pt(e){const t=[];let s=e;for(const{select:e,fusion:i,groupByCriteria:r}of Ot){const{positive:o,negative:n}=Et(s,e);s=n;const a=Tt(o,r);for(const e of a)e.length>1?t.push(i(e)):s.push(e[0])}for(const e of s)t.push(e);return t}function Lt(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}let Bt=1;const Dt=Number.MAX_SAFE_INTEGER>>>0;class Nt{static deserialize(e,t,s,i){const r=e.getUint32(),o=e.getUint32(),n=e.getUint32(),a=C.fromUint8Array(e.getBytes(!0),i),c=a.getUint32ArrayView(r),l=a.getUint32ArrayView(o),h=a.pos;return a.seekZero(),new Nt({config:i,deserialize:t,filters:[],optimize:s}).updateInternals({bucketsIndex:l,filtersIndexStart:h,numberOfFilters:n,tokensLookupIndex:c,view:a})}constructor({deserialize:e,filters:t,optimize:s,config:i}){this.bucketsIndex=y,this.filtersIndexStart=0,this.numberOfFilters=0,this.tokensLookupIndex=y,this.cache=new Map,this.view=C.empty(i),this.deserializeFilter=e,this.optimize=s,this.config=i,0!==t.length&&this.update(t,void 0)}getFilters(){const e=[];if(0===this.numberOfFilters)return e;this.view.setPos(this.filtersIndexStart);for(let t=0;t<this.numberOfFilters;t+=1)e.push(this.deserializeFilter(this.view));return this.view.seekZero(),e}getTokens(){const e=new Set;for(let t=0;t<this.bucketsIndex.length;t+=2)e.add(this.bucketsIndex[t]);return new Uint32Array(e)}getSerializedSize(){return 12+S(this.view.buffer,!0)}serialize(e){e.pushUint32(this.tokensLookupIndex.length),e.pushUint32(this.bucketsIndex.length),e.pushUint32(this.numberOfFilters),e.pushBytes(this.view.buffer,!0)}iterMatchingFilters(e,t){const s=function(){const e=Bt;return Bt=(Bt+1)%1e9,e}();for(const i of e)if(!1===this.iterBucket(i,s,t))return;this.iterBucket(0,s,t)}update(e,t){0!==this.cache.size&&this.cache.clear();const s=this.config.enableCompression;let i=0,r=0;const o=[];let n=0,a=this.view.buffer.byteLength-this.filtersIndexStart,c=this.getFilters();if(0!==c.length){void 0!==t&&0!==t.size&&(c=c.filter((e=>!t.has(e.getId())||(a-=e.getSerializedSize(s),!1))));for(const t of e)a+=t.getSerializedSize(s),c.push(t)}else{c=e;for(const t of e)a+=t.getSerializedSize(s)}if(0===c.length)return void this.updateInternals({bucketsIndex:y,filtersIndexStart:0,numberOfFilters:0,tokensLookupIndex:y,view:C.empty(this.config)});!0===this.config.debug&&c.sort(((e,t)=>e.getId()-t.getId()));const l=new Uint32Array(Math.max(Lt(2*c.length),256));for(const e of c){const t=e.getTokens();o.push(t),n+=2*t.length,r+=t.length;for(const e of t){i+=e.length;for(const t of e)l[t%l.length]+=1}}a+=4*n;const h=Math.max(2,Lt(r)),d=h-1,u=[];for(let e=0;e<h;e+=1)u.push([]);a+=4*h;const f=C.allocate(a,this.config),p=f.getUint32ArrayView(h),m=f.getUint32ArrayView(n),g=f.getPos();for(let e=0;e<o.length;e+=1){const t=c[e],s=o[e],r=f.pos;t.serialize(f);for(const e of s){let t=0,s=i+1;for(const i of e){const e=l[i%l.length];if(e<s&&(s=e,t=i,1===s))break}u[t&d].push([t,r])}}let w=0;for(let e=0;e<h;e+=1){const t=u[e];p[e]=w;for(const[e,s]of t)m[w++]=e,m[w++]=s}f.seekZero(),this.updateInternals({bucketsIndex:m,filtersIndexStart:g,numberOfFilters:o.length,tokensLookupIndex:p,view:f})}updateInternals({bucketsIndex:e,filtersIndexStart:t,numberOfFilters:s,tokensLookupIndex:i,view:r}){return this.bucketsIndex=e,this.filtersIndexStart=t,this.numberOfFilters=s,this.tokensLookupIndex=i,this.view=r,r.seekZero(),this}iterBucket(e,t,s){let i=!0===this.config.enableInMemoryCache?this.cache.get(e):void 0;if(void 0===i){const t=e&this.tokensLookupIndex.length-1,s=this.tokensLookupIndex[t];if(s===Dt)return!0;const r=t===this.tokensLookupIndex.length-1?this.bucketsIndex.length:this.tokensLookupIndex[t+1],o=[];for(let t=s;t<r;t+=2){this.bucketsIndex[t]===e&&o.push(this.bucketsIndex[t+1])}if(0===o.length)return!0;const n=[],a=this.view;for(let e=0;e<o.length;e+=1)a.setPos(o[e]),n.push(this.deserializeFilter(a));i={filters:n.length>1?this.optimize(n):n,lastRequestSeen:-1},!0===this.config.enableInMemoryCache&&this.cache.set(e,i)}if(i.lastRequestSeen!==t){i.lastRequestSeen=t;const e=i.filters;for(let t=0;t<e.length;t+=1)if(!1===s(e[t])){if(t>0){const s=e[t];e[t]=e[t-1],e[t-1]=s}return!1}}return!0}}const Mt=new Uint8Array(4);class _t{static deserialize(e,t,s){const i=new _t({deserialize:t,config:s,filters:[]});return i.filters=e.getBytes(),i}constructor({config:e,deserialize:t,filters:s}){this.deserialize=t,this.filters=Mt,this.config=e,0!==s.length&&this.update(s,void 0)}update(e,t){let s=this.filters.byteLength,i=[];const r=this.config.enableCompression,o=this.getFilters();if(0!==o.length)if(void 0===t||0===t.size)i=o;else for(const e of o)!1===t.has(e.getId())?i.push(e):s-=e.getSerializedSize(r);const n=i.length!==o.length,a=i.length;for(const t of e)s+=t.getSerializedSize(r),i.push(t);const c=i.length>a;if(0===i.length)this.filters=Mt;else if(!0===c||!0===n){const e=C.allocate(s,this.config);e.pushUint32(i.length),!0===this.config.debug&&i.sort(((e,t)=>e.getId()-t.getId()));for(const t of i)t.serialize(e);this.filters=e.buffer}}getSerializedSize(){return S(this.filters,!1)}serialize(e){e.pushBytes(this.filters)}getFilters(){if(this.filters.byteLength<=4)return[];const e=[],t=C.fromUint8Array(this.filters,this.config),s=t.getUint32();for(let i=0;i<s;i+=1)e.push(this.deserialize(t));return e}}function $t(e,t=Te){if(0===e.length)return"";const s=1024,i=[],r=` { ${t} }`;for(let t=0;t<e.length;t+=s){let o=e[t];for(let i=t+1,r=Math.min(e.length,t+s);i<r;i+=1)o+=",\n"+e[i];if(o+=r,e.length<s)return o;i.push(o)}return i.join("\n")}function Wt(e,t=Te){const s=new Map;for(const i of e){const e=i.getStyle(t),r=s.get(e);void 0===r?s.set(e,[i.getSelector()]):r.push(i.getSelector())}const i=[],r=Array.from(s.entries());for(const[e,t]of r)i.push($t(t,e));return i.join("\n\n")}function qt(e,t=Te){const s=[];for(const i of e){if(i.hasCustomStyle())return Wt(e,t);s.push(i.selector)}return $t(s,t)}function Vt(e,t){const s=fe(e,t),i=ue(e,t),r=new Uint32Array(s.length+i.length);let o=0;for(const e of s)r[o++]=e;for(const e of i)r[o++]=e;return r}class Gt{static deserialize(e,t){const s=new Gt({config:t});return s.genericRules=_t.deserialize(e,$e.deserialize,t),s.classesIndex=Nt.deserialize(e,$e.deserialize,jt,t),s.hostnameIndex=Nt.deserialize(e,$e.deserialize,jt,t),s.hrefsIndex=Nt.deserialize(e,$e.deserialize,jt,t),s.idsIndex=Nt.deserialize(e,$e.deserialize,jt,t),s.unhideIndex=Nt.deserialize(e,$e.deserialize,jt,t),s}constructor({filters:e=[],config:t}){this.genericRules=new _t({config:t,deserialize:$e.deserialize,filters:[]}),this.classesIndex=new Nt({config:t,deserialize:$e.deserialize,filters:[],optimize:jt}),this.hostnameIndex=new Nt({config:t,deserialize:$e.deserialize,filters:[],optimize:jt}),this.hrefsIndex=new Nt({config:t,deserialize:$e.deserialize,filters:[],optimize:jt}),this.idsIndex=new Nt({config:t,deserialize:$e.deserialize,filters:[],optimize:jt}),this.unhideIndex=new Nt({config:t,deserialize:$e.deserialize,filters:[],optimize:jt}),this.baseStylesheet=null,this.extraGenericRules=null,0!==e.length&&this.update(e,void 0,t)}getFilters(){return[].concat(this.genericRules.getFilters(),this.classesIndex.getFilters(),this.hostnameIndex.getFilters(),this.hrefsIndex.getFilters(),this.idsIndex.getFilters(),this.unhideIndex.getFilters())}update(e,t,s){const i=[],r=[],o=[],n=[],a=[],c=[];for(const t of e)t.isUnhide()?c.push(t):t.isGenericHide()?t.isClassSelector()?i.push(t):t.isIdSelector()?a.push(t):t.isHrefSelector()?n.push(t):r.push(t):!1!==t.isExtended()&&!0!==s.loadExtendedSelectors||o.push(t);this.genericRules.update(r,t),this.classesIndex.update(i,t),this.hostnameIndex.update(o,t),this.hrefsIndex.update(n,t),this.idsIndex.update(a,t),this.unhideIndex.update(c,t)}getSerializedSize(){return this.genericRules.getSerializedSize()+this.classesIndex.getSerializedSize()+this.hostnameIndex.getSerializedSize()+this.hrefsIndex.getSerializedSize()+this.idsIndex.getSerializedSize()+this.unhideIndex.getSerializedSize()}serialize(e){this.genericRules.serialize(e),this.classesIndex.serialize(e),this.hostnameIndex.serialize(e),this.hrefsIndex.serialize(e),this.idsIndex.serialize(e),this.unhideIndex.serialize(e)}getCosmeticsFilters({domain:e,hostname:t,classes:s=[],hrefs:i=[],ids:r=[],allowGenericHides:o=!0,allowSpecificHides:n=!0,getRulesFromDOM:a=!0,getRulesFromHostname:c=!0,isFilterExcluded:l}){const h=Vt(t,e),d=[];if(!0===c&&this.hostnameIndex.iterMatchingFilters(h,(s=>(!0!==n&&!0!==s.isScriptInject()||!s.match(t,e)||(null==l?void 0:l(s))||d.push(s),!0))),!0===o&&!0===c){const s=this.getGenericRules();for(const i of s)!0!==i.match(t,e)||(null==l?void 0:l(i))||d.push(i)}!0===o&&!0===a&&0!==s.length&&this.classesIndex.iterMatchingFilters(J(s),(s=>(s.match(t,e)&&!(null==l?void 0:l(s))&&d.push(s),!0))),!0===o&&!0===a&&0!==r.length&&this.idsIndex.iterMatchingFilters(J(r),(s=>(s.match(t,e)&&!(null==l?void 0:l(s))&&d.push(s),!0))),!0===o&&!0===a&&0!==i.length&&this.hrefsIndex.iterMatchingFilters(function(e){const t=e.sort();let s=1;for(let e=1;e<t.length;e+=1)t[s-1]!==t[e]&&(t[s++]=t[e]);return t.subarray(0,s)}(function(e){if(0===e.length)return Ct;if(1===e.length)return e[0];let t=0;for(let s=0;s<e.length;s+=1)t+=e[s].length;const s=new Uint32Array(t);let i=0;for(let t=0;t<e.length;t+=1){const r=e[t];for(let e=0;e<r.length;e+=1)s[i++]=r[e]}return s}(i.map((e=>re(e))))),(s=>(s.match(t,e)&&!(null==l?void 0:l(s))&&d.push(s),!0)));const u=[];return 0!==d.length&&this.unhideIndex.iterMatchingFilters(h,(s=>(s.match(t,e)&&!(null==l?void 0:l(s))&&u.push(s),!0))),{filters:d,unhides:u}}getStylesheetsFromFilters({filters:e,extendedFilters:t},{getBaseRules:s,allowGenericHides:i,hidingStyle:r=Te}){let o=!1===s||!1===i?"":this.getBaseStylesheet();r!==Te&&(o=o.replace(Te,r)),0!==e.length&&(0!==o.length&&(o+="\n\n"),o+=qt(e,r));const n=[];if(0!==t.length){const e=new Map;for(const s of t){const t=s.getSelectorAST();if(void 0!==t){const i=s.isRemove()?void 0:s.getStyleAttributeHash();void 0!==i&&e.set(s.getStyle(r),i),n.push({id:s.getId(),ast:t,remove:s.isRemove(),attribute:i})}}0!==e.size&&(0!==o.length&&(o+="\n\n"),o+=[...e.entries()].map((([e,t])=>`[${t}] { ${e} }`)).join("\n\n"))}return{stylesheet:o,extended:n}}getGenericRules(){return null===this.extraGenericRules?this.lazyPopulateGenericRulesCache().genericRules:this.extraGenericRules}getBaseStylesheet(){return null===this.baseStylesheet?this.lazyPopulateGenericRulesCache().baseStylesheet:this.baseStylesheet}lazyPopulateGenericRulesCache(){if(null===this.baseStylesheet||null===this.extraGenericRules){const e=this.unhideIndex.getFilters(),t=new Set;for(const s of e)t.add(s.getSelector());const s=this.genericRules.getFilters(),i=[],r=[];for(const e of s)e.hasCustomStyle()||e.isScriptInject()||e.hasHostnameConstraint()||t.has(e.getSelector())?r.push(e):i.push(e);this.baseStylesheet=qt(i),this.extraGenericRules=r}return{baseStylesheet:this.baseStylesheet,genericRules:this.extraGenericRules}}}class Kt{static deserialize(e,t){const s=new Kt({config:t});return s.index=Nt.deserialize(e,ct.deserialize,t.enableOptimizations?Pt:Ht,t),s.badFilters=_t.deserialize(e,ct.deserialize,t),s}constructor({filters:e=[],config:t}){this.index=new Nt({config:t,deserialize:ct.deserialize,filters:[],optimize:t.enableOptimizations?Pt:Ht}),this.badFiltersIds=null,this.badFilters=new _t({config:t,deserialize:ct.deserialize,filters:[]}),0!==e.length&&this.update(e,void 0)}getFilters(){return[].concat(this.badFilters.getFilters(),this.index.getFilters())}update(e,t){const s=[],i=[];for(const t of e)t.isBadFilter()?s.push(t):i.push(t);this.badFilters.update(s,t),this.index.update(i,t),this.badFiltersIds=null}getSerializedSize(){return this.badFilters.getSerializedSize()+this.index.getSerializedSize()}serialize(e){this.index.serialize(e),this.badFilters.serialize(e)}matchAll(e,t){const s=[];return this.index.iterMatchingFilters(e.getTokens(),(i=>(i.match(e)&&!1===this.isFilterDisabled(i)&&!(null==t?void 0:t(i))&&s.push(i),!0))),s}match(e,t){let s;return this.index.iterMatchingFilters(e.getTokens(),(i=>!(i.match(e)&&!1===this.isFilterDisabled(i)&&!(null==t?void 0:t(i)))||(s=i,!1))),s}isFilterDisabled(e){if(null===this.badFiltersIds){const e=this.badFilters.getFilters();if(0===e.length)return!1;const t=new Set;for(const s of e)t.add(s.getIdWithoutBadFilter());this.badFiltersIds=t}return this.badFiltersIds.has(e.getId())}}class Zt{static deserialize(e,t){const s=new Zt({config:t});return s.networkIndex=Nt.deserialize(e,ct.deserialize,t.enableOptimizations?Pt:Ht,t),s.exceptionsIndex=Nt.deserialize(e,ct.deserialize,t.enableOptimizations?Pt:Ht,t),s.cosmeticIndex=Nt.deserialize(e,$e.deserialize,jt,t),s.unhideIndex=Nt.deserialize(e,$e.deserialize,jt,t),s}constructor({filters:e=[],config:t}){this.config=t,this.networkIndex=new Nt({config:t,deserialize:ct.deserialize,filters:[],optimize:t.enableOptimizations?Pt:Ht}),this.exceptionsIndex=new Nt({config:t,deserialize:ct.deserialize,filters:[],optimize:t.enableOptimizations?Pt:Ht}),this.cosmeticIndex=new Nt({config:t,deserialize:$e.deserialize,filters:[],optimize:jt}),this.unhideIndex=new Nt({config:t,deserialize:$e.deserialize,filters:[],optimize:jt}),0!==e.length&&this.update(e,void 0)}update(e,t){const s=[],i=[],r=[],o=[];for(const t of e)t.isNetworkFilter()?t.isException()?i.push(t):s.push(t):t.isCosmeticFilter()&&(t.isUnhide()?o.push(t):r.push(t));this.networkIndex.update(s,t),this.exceptionsIndex.update(i,t),this.cosmeticIndex.update(r,t),this.unhideIndex.update(o,t)}serialize(e){this.networkIndex.serialize(e),this.exceptionsIndex.serialize(e),this.cosmeticIndex.serialize(e),this.unhideIndex.serialize(e)}getSerializedSize(){return this.networkIndex.getSerializedSize()+this.exceptionsIndex.getSerializedSize()+this.cosmeticIndex.getSerializedSize()+this.unhideIndex.getSerializedSize()}getHTMLFilters(e,t){const s=[],i=[],r=[],o=[];if(!0===this.config.loadNetworkFilters&&this.networkIndex.iterMatchingFilters(e.getTokens(),(i=>(i.match(e)&&!(null==t?void 0:t(i))&&s.push(i),!0))),0!==s.length&&this.exceptionsIndex.iterMatchingFilters(e.getTokens(),(s=>(s.match(e)&&!(null==t?void 0:t(s))&&r.push(s),!0))),!0===this.config.loadCosmeticFilters&&e.isMainFrame()){const{hostname:s,domain:r=""}=e,n=Vt(s,r);this.cosmeticIndex.iterMatchingFilters(n,(e=>(e.match(s,r)&&!(null==t?void 0:t(e))&&i.push(e),!0))),0!==i.length&&this.unhideIndex.iterMatchingFilters(n,(e=>(e.match(s,r)&&!(null==t?void 0:t(e))&&o.push(e),!0)))}return{networkFilters:s,cosmeticFilters:i,unhides:o,exceptions:r}}getFilters(){return[].concat(this.networkIndex.getFilters(),this.exceptionsIndex.getFilters(),this.cosmeticIndex.getFilters(),this.unhideIndex.getFilters())}}const Xt=Number.MAX_SAFE_INTEGER>>>0;class Yt{static deserialize(e,t){const s=e.getUint32(),i=e.getUint32(),r=e.getUint32(),o=C.fromUint8Array(e.getBytes(!0),{enableCompression:!1}),n=o.getUint32ArrayView(s),a=o.getUint32ArrayView(i),c=o.pos;return o.seekZero(),new Yt({deserialize:t,values:[],getKeys:()=>[],getSerializedSize:()=>0,serialize:()=>{}}).updateInternals({bucketsIndex:a,valuesIndexStart:c,numberOfValues:r,tokensLookupIndex:n,view:o})}constructor({serialize:e,deserialize:t,getKeys:s,getSerializedSize:i,values:r}){if(this.cache=new Map,this.bucketsIndex=y,this.tokensLookupIndex=y,this.valuesIndexStart=0,this.numberOfValues=0,this.view=C.empty({enableCompression:!1}),this.deserializeValue=t,0!==r.length){const t=[];let o=0,n=0;for(const e of r)n+=i(e);if(0===r.length)return void this.updateInternals({bucketsIndex:y,valuesIndexStart:0,numberOfValues:0,tokensLookupIndex:y,view:C.empty({enableCompression:!1})});for(const e of r){const i=s(e);t.push(i),o+=2*i.length}n+=4*o;const a=Math.max(2,Lt(r.length)),c=a-1,l=[];for(let e=0;e<a;e+=1)l.push([]);n+=4*a;const h=C.allocate(n,{enableCompression:!1}),d=h.getUint32ArrayView(a),u=h.getUint32ArrayView(o),f=h.getPos();for(let s=0;s<t.length;s+=1){const i=r[s],o=t[s],n=h.pos;e(i,h);for(const e of o)l[e&c].push([e,n])}let p=0;for(let e=0;e<a;e+=1){const t=l[e];d[e]=p;for(const[e,s]of t)u[p++]=e,u[p++]=s}this.updateInternals({bucketsIndex:u,valuesIndexStart:f,numberOfValues:t.length,tokensLookupIndex:d,view:h})}}updateInternals({bucketsIndex:e,valuesIndexStart:t,numberOfValues:s,tokensLookupIndex:i,view:r}){return this.bucketsIndex=e,this.valuesIndexStart=t,this.numberOfValues=s,this.tokensLookupIndex=i,this.view=r,r.seekZero(),this}getValues(){const e=[];if(0===this.numberOfValues)return e;this.view.setPos(this.valuesIndexStart);for(let t=0;t<this.numberOfValues;t+=1)e.push(this.deserializeValue(this.view));return this.view.seekZero(),e}getSerializedSize(){return 12+S(this.view.buffer,!0)}serialize(e){e.pushUint32(this.tokensLookupIndex.length),e.pushUint32(this.bucketsIndex.length),e.pushUint32(this.numberOfValues),e.pushBytes(this.view.buffer,!0)}get(e){const t=this.cache.get(e);if(void 0!==t)return t;const s=e&this.tokensLookupIndex.length-1,i=this.tokensLookupIndex[s];if(i===Xt)return[];const r=s===this.tokensLookupIndex.length-1?this.bucketsIndex.length:this.tokensLookupIndex[s+1],o=[];for(let t=i;t<r;t+=2){this.bucketsIndex[t]===e&&o.push(this.bucketsIndex[t+1])}if(0===o.length)return[];const n=[],a=this.view;for(let e=0;e<o.length;e+=1)a.setPos(o[e]),n.push(this.deserializeValue(a));return this.cache.set(e,n),n}}function Jt(e){if(null===e)return!1;if("object"!=typeof e)return!1;const{key:t,name:s,color:i,description:r}=e;return"string"==typeof t&&("string"==typeof s&&("string"==typeof i&&"string"==typeof r))}function Qt(e){return Y(e.key)}function es(e){return I(e.key)+I(e.name)+I(e.color)+I(e.description)}function ts(e,t){t.pushUTF8(e.key),t.pushUTF8(e.name),t.pushUTF8(e.color),t.pushUTF8(e.description)}function ss(e){return{key:e.getUTF8(),name:e.getUTF8(),color:e.getUTF8(),description:e.getUTF8()}}function is(e){return new Yt({getSerializedSize:es,getKeys:e=>[Qt(e)],serialize:ts,deserialize:ss,values:e})}function rs(e){if(null===e)return!1;if("object"!=typeof e)return!1;const{key:t,name:s,description:i,country:r,website_url:o,privacy_policy_url:n,privacy_contact:a,ghostery_id:c}=e;return"string"==typeof t&&("string"==typeof s&&((null===i||"string"==typeof i)&&((null===r||"string"==typeof r)&&((null===o||"string"==typeof o)&&((null===n||"string"==typeof n)&&((null===a||"string"==typeof a)&&(null===c||"string"==typeof c)))))))}function os(e){return Y(e.key)}function ns(e){return I(e.key)+I(e.name)+I(e.description||"")+I(e.website_url||"")+I(e.country||"")+I(e.privacy_policy_url||"")+I(e.privacy_contact||"")+I(e.ghostery_id||"")}function as(e,t){t.pushUTF8(e.key),t.pushUTF8(e.name),t.pushUTF8(e.description||""),t.pushUTF8(e.website_url||""),t.pushUTF8(e.country||""),t.pushUTF8(e.privacy_policy_url||""),t.pushUTF8(e.privacy_contact||""),t.pushUTF8(e.ghostery_id||"")}function cs(e){return{key:e.getUTF8(),name:e.getUTF8(),description:e.getUTF8()||null,website_url:e.getUTF8()||null,country:e.getUTF8()||null,privacy_policy_url:e.getUTF8()||null,privacy_contact:e.getUTF8()||null,ghostery_id:e.getUTF8()||null}}function ls(e){return new Yt({getSerializedSize:ns,getKeys:e=>[os(e)],serialize:as,deserialize:cs,values:e})}function hs(e){if(null===e)return!1;if("object"!=typeof e)return!1;const{key:t,name:s,category:i,organization:r,alias:o,website_url:n,domains:a,filters:c}=e;return"string"==typeof t&&("string"==typeof s&&("string"==typeof i&&((null===r||"string"==typeof r)&&(("string"==typeof o||null===o)&&((null===n||"string"==typeof n)&&(!(!Array.isArray(a)||!a.every((e=>"string"==typeof e)))&&!(!Array.isArray(c)||!c.every((e=>"string"==typeof e)))))))))}function ds(e){const t=[];for(const s of e.filters){const e=ct.parse(s);null!==e&&t.push(e.getId())}for(const s of e.domains){const e=ct.parse(`||${s}^`);null!==e&&t.push(e.getId())}return[...new Set(t)]}function us(e){let t=k(e.domains.length);for(const s of e.domains)t+=I(s);let s=k(e.filters.length);for(const t of e.filters)s+=I(t);return I(e.key)+I(e.name)+I(e.category)+I(e.organization||"")+I(e.alias||"")+I(e.website_url||"")+I(e.ghostery_id||"")+t+s}function fs(e,t){t.pushUTF8(e.key),t.pushUTF8(e.name),t.pushUTF8(e.category),t.pushUTF8(e.organization||""),t.pushUTF8(e.alias||""),t.pushUTF8(e.website_url||""),t.pushUTF8(e.ghostery_id||""),t.pushLength(e.domains.length);for(const s of e.domains)t.pushUTF8(s);t.pushLength(e.filters.length);for(const s of e.filters)t.pushUTF8(s)}function ps(e){const t=e.getUTF8(),s=e.getUTF8(),i=e.getUTF8(),r=e.getUTF8()||null,o=e.getUTF8()||null,n=e.getUTF8()||null,a=e.getUTF8()||null,c=e.getLength(),l=[];for(let t=0;t<c;t+=1)l.push(e.getUTF8());const h=e.getLength(),d=[];for(let t=0;t<h;t+=1)d.push(e.getUTF8());return{key:t,name:s,category:i,organization:r,alias:o,website_url:n,ghostery_id:a,domains:l,filters:d}}function ms(e){return new Yt({getSerializedSize:us,getKeys:ds,serialize:fs,deserialize:ps,values:e})}class gs{static deserialize(e){const t=new gs(null);return t.categories=Yt.deserialize(e,ss),t.organizations=Yt.deserialize(e,cs),t.patterns=Yt.deserialize(e,ps),t}constructor(e){if(!e)return this.organizations=ls([]),this.categories=is([]),void(this.patterns=ms([]));const{patterns:t,organizations:s,categories:i}=e,r=[];if("object"==typeof i)for(const[e,t]of Object.entries(i)){if("object"!=typeof t)continue;const s={key:e,...t};Jt(s)?r.push(s):console.error("?? invalid category",s)}this.categories=is(r);const o=[];if("object"==typeof s)for(const[e,t]of Object.entries(s)){if("object"!=typeof t)continue;const s={key:e,...t};rs(s)?o.push(s):console.error("?? invalid organization",s)}this.organizations=ls(o);const n=[];if("object"==typeof t)for(const[e,s]of Object.entries(t)){if("object"!=typeof s)continue;const t={key:e,...s};hs(t)?n.push(t):console.error("?? invalid pattern",t)}this.patterns=ms(n)}getCategories(){return this.categories.getValues()}getOrganizations(){return this.organizations.getValues()}getPatterns(){return this.patterns.getValues()}getSerializedSize(){return this.categories.getSerializedSize()+this.organizations.getSerializedSize()+this.patterns.getSerializedSize()}serialize(e){this.categories.serialize(e),this.organizations.serialize(e),this.patterns.serialize(e)}fromFilter(e){return this.fromId(e.getId())}fromDomain(e){const t=e.split(".");for(;t.length>=2;t.shift()){const e=t.join("."),s=ct.parse(`||${e}^`);if(null===s)continue;const i=this.fromId(s.getId());if(i.length>0)return i}return[]}fromId(e){var t,s;const i=[];for(const r of this.patterns.get(e))i.push({pattern:r,category:null===(t=this.categories.get(Qt({key:r.category})))||void 0===t?void 0:t[0],organization:null!==r.organization?null===(s=this.organizations.get(os({key:r.organization})))||void 0===s?void 0:s[0]:null});return i}}class ys{static deserialize(e){const t=new Set;for(let s=0,i=e.getUint32();s<i;s++)t.add(e.getUint32());const s=[];for(let t=0,i=e.getUint32();t<i;t++)s.push(vt.deserialize(e));return new this({excluded:t,preprocessors:s})}constructor({excluded:e=new Set,preprocessors:t=[]}){this.excluded=e,this.preprocessors=t}isFilterExcluded(e){return this.excluded.has(e.getId())}updateEnv(e){this.excluded.clear();for(const t of this.preprocessors)if(!t.evaluate(e))for(const e of t.filterIDs)this.excluded.add(e)}update({added:e,removed:t},s){if(t)for(const e of t){const t=this.preprocessors.find((t=>t.condition===e.condition));if(t)for(const s of e.filterIDs)t.filterIDs.delete(s)}if(e)for(const t of e){const e=this.preprocessors.find((e=>e.condition===t.condition));if(e)for(const s of t.filterIDs)e.filterIDs.add(s);else this.preprocessors.push(t)}(t&&0!==t.length||e&&0!==e.length)&&this.updateEnv(s)}serialize(e){e.pushUint32(this.excluded.size);for(const t of this.excluded)e.pushUint32(t);e.pushUint32(this.preprocessors.length);for(const t of this.preprocessors)t.serialize(e)}getSerializedSize(){let e=4*(1+this.excluded.size);e+=4;for(const t of this.preprocessors)e+=t.getSerializedSize();return e}}const ws=811;function vs(e){if(0===e.length)return;let t,s=0;for(const i of e){const e=(i.isImportant()?4:0)|(i.isException()?1:2);e>=s&&(s=e,t=i)}return void 0!==t&&!1!==t.isException()?t:void 0}const bs=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,10,3,3,3,3,3,3,3,3,3,3,3,3,4,3,3,11,6,6,6,5,8,8,8,8,8,8,8,8,8,8,8,0,1,2,3,5,8,7,1,1,1,4,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,0,1,0,1,1,1,1,1,1,1,2,1,1,1,1,1,2,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,3,1,3,1,1,1,1,1,1,1,3,1,1,1,1,1,3,1,3,1,1,1,1,1,1,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1]);e.Config=R,e.CosmeticFilter=$e,e.ENGINE_VERSION=ws,e.FiltersEngine=class extends H{static fromCached(e,t){if(void 0===t)return e();const{path:s,read:i,write:r}=t;return i(s).then((e=>this.deserialize(e))).catch((()=>e().then((e=>r(s,e.serialize()).then((()=>e))))))}static empty(e={}){return new this({config:e})}static fromLists(e,t,s={},i){return this.fromCached((()=>{const i=M(e,t),r=_(e);return Promise.all([i,r]).then((([e,t])=>{const i=this.parse(e.join("\n"),s);return void 0!==t&&i.updateResources(t,""+t.length),i}))}),i)}static fromPrebuiltAdsOnly(e=fetch,t){return this.fromLists(e,B,{},t)}static fromPrebuiltAdsAndTracking(e=fetch,t){return this.fromLists(e,D,{},t)}static fromPrebuiltFull(e=fetch,t){return this.fromLists(e,N,{},t)}static fromTrackerDB(e,t={}){const s=new R(t),i=new gs(e),r=[];for(const e of i.getPatterns())r.push(...e.filters);const o=this.parse(r.join("\n"),s);return o.metadata=i,o}static merge(e,{skipResources:t=!1,overrideConfig:s={}}={}){if(!e||e.length<2)throw new Error("merging engines requires at least two engines");for(const t of e)if(t.config.enableCompression!==e[0].config.enableCompression)throw new Error(`compression of all merged engines must match with the first one: "${e[0].config.enableCompression}" but got: "${t.config.enableCompression}"`);const i=new Map,r=new Map,o=new Map,n=[],a={organizations:{},categories:{},patterns:{}};for(const t of e){const e=t.getFilters();for(const t of e.networkFilters)r.set(t.getId(),t);for(const t of e.cosmeticFilters)o.set(t.getId(),t);for(const e of t.preprocessors.preprocessors)n.push(e);for(const[e,s]of t.lists)i.has(e)||i.set(e,s);if(void 0!==t.metadata){for(const e of t.metadata.organizations.getValues())void 0===a.organizations[e.key]&&(a.organizations[e.key]=e);for(const e of t.metadata.categories.getValues())void 0===a.categories[e.key]&&(a.categories[e.key]=e);for(const e of t.metadata.patterns.getValues())void 0===a.patterns[e.key]&&(a.patterns[e.key]=e)}}const c=new this({networkFilters:Array.from(r.values()),cosmeticFilters:Array.from(o.values()),preprocessors:n,lists:i,config:new R({...e[0].config,...s})});if(Object.keys(a.categories).length+Object.keys(a.organizations).length+Object.keys(a.patterns).length!==0&&(c.metadata=new gs(a)),!0!==t){for(const t of e.slice(1))if(t.resources.checksum!==e[0].resources.checksum)throw new Error(`resource checksum of all merged engines must match with the first one: "${e[0].resources.checksum}" but got: "${t.resources.checksum}"`);c.resources=At.copy(e[0].resources)}return c}static parse(e,t={}){const s=new R(t);return new this({...St(e,s),config:s})}static deserialize(e){const t=C.fromUint8Array(e,{enableCompression:!1}),s=t.getUint16();if(ws!==s)throw new Error(`serialized engine version mismatch, expected 811 but got ${s}`);const i=R.deserialize(t);if(i.enableCompression&&t.enableCompression(),i.integrityCheck){const s=t.pos;t.pos=e.length-4;const i=t.checksum(),r=t.getUint32();if(i!==r)throw new Error(`serialized engine checksum mismatch, expected ${r} but got ${i}`);t.pos=s}const r=new this({config:i});r.resources=At.deserialize(t);const o=new Map,n=t.getUint16();for(let e=0;e<n;e+=1)o.set(t.getASCII(),t.getASCII());r.lists=o,r.preprocessors=ys.deserialize(t),r.importants=Kt.deserialize(t,i),r.redirects=Kt.deserialize(t,i),r.removeparams=Kt.deserialize(t,i),r.filters=Kt.deserialize(t,i),r.exceptions=Kt.deserialize(t,i),r.csp=Kt.deserialize(t,i),r.cosmetics=Gt.deserialize(t,i),r.hideExceptions=Kt.deserialize(t,i),r.htmlFilters=Zt.deserialize(t,i);return t.getBool()&&(r.metadata=gs.deserialize(t)),t.seekZero(),r}constructor({cosmeticFilters:e=[],networkFilters:t=[],preprocessors:s=[],config:i=new R,lists:r=new Map}={}){super(),this.config=new R(i),this.lists=r,this.preprocessors=new ys({}),this.csp=new Kt({config:this.config}),this.hideExceptions=new Kt({config:this.config}),this.exceptions=new Kt({config:this.config}),this.importants=new Kt({config:this.config}),this.redirects=new Kt({config:this.config}),this.removeparams=new Kt({config:this.config}),this.filters=new Kt({config:this.config}),this.cosmetics=new Gt({config:this.config}),this.htmlFilters=new Zt({config:this.config}),this.resources=new At,0===t.length&&0===e.length||this.update({newCosmeticFilters:e,newNetworkFilters:t,newPreprocessors:s})}isFilterExcluded(e){return this.preprocessors.isFilterExcluded(e)}updateEnv(e){this.preprocessors.updateEnv(e)}getSerializedSize(){let e=1+this.config.getSerializedSize()+this.resources.getSerializedSize()+this.preprocessors.getSerializedSize()+this.filters.getSerializedSize()+this.exceptions.getSerializedSize()+this.importants.getSerializedSize()+this.redirects.getSerializedSize()+this.removeparams.getSerializedSize()+this.csp.getSerializedSize()+this.cosmetics.getSerializedSize()+this.hideExceptions.getSerializedSize()+this.htmlFilters.getSerializedSize()+4;for(const[t,s]of this.lists)e+=z(t)+z(s);return e+=1,void 0!==this.metadata&&(e+=this.metadata.getSerializedSize()),e}serialize(e){const t=C.fromUint8Array(e||new Uint8Array(this.getSerializedSize()),this.config);t.pushUint16(ws),this.config.serialize(t),this.resources.serialize(t),t.pushUint16(this.lists.size);for(const[e,s]of Array.from(this.lists.entries()).sort())t.pushASCII(e),t.pushASCII(s);return this.preprocessors.serialize(t),this.importants.serialize(t),this.redirects.serialize(t),this.removeparams.serialize(t),this.filters.serialize(t),this.exceptions.serialize(t),this.csp.serialize(t),this.cosmetics.serialize(t),this.hideExceptions.serialize(t),this.htmlFilters.serialize(t),t.pushBool(void 0!==this.metadata),void 0!==this.metadata&&this.metadata.serialize(t),this.config.integrityCheck&&t.pushUint32(t.checksum()),t.subarray()}loadedLists(){return Array.from(this.lists.keys())}hasList(e,t){return this.lists.has(e)&&this.lists.get(e)===t}updateResources(e,t){return this.resources.checksum!==t&&(this.resources=At.parse(e,{checksum:t}),!0)}getFilters(){const e=this.cosmetics.getFilters(),t=[...this.filters.getFilters(),...this.exceptions.getFilters(),...this.importants.getFilters(),...this.redirects.getFilters(),...this.csp.getFilters(),...this.hideExceptions.getFilters()];for(const s of this.htmlFilters.getFilters())s.isNetworkFilter()?t.push(s):s.isCosmeticFilter()&&e.push(s);return{cosmeticFilters:e,networkFilters:t}}update({newNetworkFilters:e=[],newCosmeticFilters:t=[],newPreprocessors:s=[],removedCosmeticFilters:i=[],removedNetworkFilters:r=[],removedPreprocessors:o=[]},n=new ht){let a=!1;!this.config.loadPreprocessors||0===s.length&&0===o.length||(a=!0,this.preprocessors.update({added:s,removed:o},n));const c=[];if(this.config.loadCosmeticFilters&&(0!==t.length||0!==i.length)){a=!0;const e=[];for(const s of t)s.isHtmlFiltering()?c.push(s):e.push(s);this.cosmetics.update(e,0===i.length?void 0:new Set(i),this.config)}if(this.config.loadNetworkFilters&&(0!==e.length||0!==r.length)){a=!0;const t=[],s=[],i=[],o=[],n=[],l=[],h=[];for(const r of e)r.isCSP()?s.push(r):r.isHtmlFilteringRule()?c.push(r):r.isGenericHide()||r.isSpecificHide()?h.push(r):r.isException()?r.isRemoveParam()?l.push(r):i.push(r):r.isImportant()?o.push(r):r.isRedirect()?n.push(r):r.isRemoveParam()?l.push(r):t.push(r);const d=0===r.length?void 0:new Set(r);this.importants.update(o,d),this.redirects.update(n,d),this.removeparams.update(l,d),this.filters.update(t,d),!0===this.config.loadExceptionFilters&&this.exceptions.update(i,d),!0===this.config.loadCSPFilters&&this.csp.update(s,d),this.hideExceptions.update(h,d)}if(this.config.enableHtmlFiltering&&(0!==c.length||0!==r.length||0!==i.length)){const e=new Set([...r,...i]);this.htmlFilters.update(c,e)}return a}updateFromDiff({added:e,removed:t,preprocessors:s},i){const r=[],o=[],n=[],a=[],c=[],l=[];if(void 0!==t&&0!==t.length){const{networkFilters:e,cosmeticFilters:s}=St(t.join("\n"),this.config);Array.prototype.push.apply(a,s),Array.prototype.push.apply(c,e)}if(void 0!==e&&0!==e.length){const{networkFilters:t,cosmeticFilters:s}=St(e.join("\n"),this.config);Array.prototype.push.apply(r,s),Array.prototype.push.apply(o,t)}if(void 0!==s)for(const[e,t]of Object.entries(s)){if(void 0!==t.removed&&0!==t.removed.length){const{networkFilters:s,cosmeticFilters:i}=St(t.removed.join("\n"),this.config),r=new Set([].concat(i.map((e=>e.getId()))).concat(s.map((e=>e.getId()))));l.push(new vt({condition:e,filterIDs:r}))}if(void 0!==t.added&&0!==t.added.length){const{networkFilters:s,cosmeticFilters:i}=St(t.added.join("\n"),this.config),r=new Set([].concat(i.map((e=>e.getId()))).concat(s.map((e=>e.getId()))));n.push(new vt({condition:e,filterIDs:r}))}}return this.update({newCosmeticFilters:r,newNetworkFilters:o,newPreprocessors:n,removedCosmeticFilters:a.map((e=>e.getId())),removedNetworkFilters:c.map((e=>e.getId())),removedPreprocessors:l},i)}getHtmlFilters(t){const s=[];if(!1===this.config.enableHtmlFiltering)return s;const{networkFilters:i,exceptions:r,cosmeticFilters:o,unhides:n}=this.htmlFilters.getHTMLFilters(t,this.isFilterExcluded.bind(this));if(0!==o.length){const i=new Map(n.map((e=>[e.getSelector(),e])));for(const r of o){const o=r.getExtendedSelector();if(void 0===o)continue;const n=i.get(r.getSelector());void 0===n&&s.push(o),this.emit("filter-matched",{filter:r,exception:n},{request:t,filterType:e.FilterType.COSMETIC})}}if(0!==i.length){const o=new Map;let n;for(const e of r){const t=e.optionValue;if(""===t){n=e;break}o.set(t,e)}for(const r of i){const i=r.getHtmlModifier();if(null===i)continue;const a=n||o.get(r.optionValue);this.emit("filter-matched",{filter:r,exception:a},{request:t,filterType:e.FilterType.NETWORK}),void 0===a&&s.push(["replace",i])}}return 0!==s.length&&this.emit("html-filtered",s,t.url),s}getCosmeticsFilters({url:e,hostname:t,domain:s,classes:i,hrefs:r,ids:o,getBaseRules:n=!0,getInjectionRules:a=!0,getExtendedRules:c=!0,getRulesFromDOM:l=!0,getRulesFromHostname:h=!0,hidingStyle:d,callerContext:u}){if(!1===this.config.loadCosmeticFilters)return{active:!1,extended:[],scripts:[],styles:""};const{matches:f,allowGenericHides:p}=this.matchCosmeticFilters({url:e,hostname:t,domain:s,classes:i,hrefs:r,ids:o,getRulesFromDOM:l,getRulesFromHostname:h,getInjectionRules:a,getExtendedRules:c,callerContext:u}),m=[];for(const{filter:e,exception:t}of f)void 0!==e&&void 0===t&&m.push(e);const{extended:g,scripts:y,styles:w}=this.injectCosmeticFilters(m,{url:e,injectScriptlets:a,injectExtended:c,allowGenericHides:p,getBaseRules:n,hidingStyle:d});return{active:!0,extended:g,scripts:y,styles:w}}injectCosmeticFilters(e,{url:t,injectStyles:s=!0,injectScriptlets:i,injectExtended:r,allowGenericHides:o=!0,getBaseRules:n,hidingStyle:a}){const c=[],l=[],h=[];for(const t of e)if(i&&t.isScriptInject()){const e=t.getScript(this.resources.getScriptlet.bind(this.resources));void 0!==e&&c.push(e)}else t.isExtended()?!0===r&&this.config.loadExtendedSelectors&&h.push(t):!0===s&&l.push(t);const d=this.cosmetics.getStylesheetsFromFilters({filters:l,extendedFilters:h},{getBaseRules:n,allowGenericHides:o,hidingStyle:a});for(const e of c)this.emit("script-injected",e,t);return 0!==d.stylesheet.length&&this.emit("style-injected",d.stylesheet,t),{extended:d.extended,scripts:c,styles:d.stylesheet}}matchCosmeticFilters({url:t,hostname:s,domain:i,classes:r,hrefs:o,ids:n,getRulesFromDOM:a=!0,getRulesFromHostname:c=!0,getInjectionRules:l,getExtendedRules:h,callerContext:d}){i||(i="");const u=[],f=this.hideExceptions.matchAll(pe.fromRawDetails({domain:i,hostname:s,url:t,sourceDomain:"",sourceHostname:"",sourceUrl:""}),this.isFilterExcluded.bind(this)),p=[],m=[];for(const e of f)e.isSpecificHide()&&m.push(e),e.isGenericHide()&&p.push(e);const g=vs(p),y=vs(m);if(void 0!==g){const s={filter:void 0,exception:g};u.push(s),this.emit("filter-matched",s,{url:t,callerContext:d,filterType:e.FilterType.COSMETIC})}if(void 0!==y&&g!==y){const s={filter:void 0,exception:y};u.push(s),this.emit("filter-matched",s,{url:t,callerContext:d,filterType:e.FilterType.COSMETIC})}const{filters:w,unhides:v}=this.cosmetics.getCosmeticsFilters({domain:i,hostname:s,classes:r,hrefs:o,ids:n,allowGenericHides:void 0===g,allowSpecificHides:void 0===y,getRulesFromDOM:a,getRulesFromHostname:c,isFilterExcluded:this.isFilterExcluded.bind(this)});let b;const x=new Map;for(const e of v)!0===e.isScriptInject()&&!0===e.isUnhide()&&0===e.getSelector().length?b=e:x.set(_e(e,this.resources.getScriptletCanonicalName.bind(this.resources)),e);for(const s of w){if(s.isExtended()&&!1===h)continue;let i=x.get(_e(s,this.resources.getScriptletCanonicalName.bind(this.resources)));s.isScriptInject()&&(void 0!==b&&(i=b),!1===l)||(u.push({filter:s,exception:i}),this.emit("filter-matched",{filter:s,exception:i},{url:t,callerContext:d,filterType:e.FilterType.COSMETIC}))}return{matches:u,allowGenericHides:void 0===g}}matchAll(e){const t=[];return e.isSupported&&(Array.prototype.push.apply(t,this.importants.matchAll(e,this.isFilterExcluded.bind(this))),Array.prototype.push.apply(t,this.filters.matchAll(e,this.isFilterExcluded.bind(this))),Array.prototype.push.apply(t,this.exceptions.matchAll(e,this.isFilterExcluded.bind(this))),Array.prototype.push.apply(t,this.csp.matchAll(e,this.isFilterExcluded.bind(this))),Array.prototype.push.apply(t,this.hideExceptions.matchAll(e,this.isFilterExcluded.bind(this))),Array.prototype.push.apply(t,this.redirects.matchAll(e,this.isFilterExcluded.bind(this)))),new Set(t)}getCSPDirectives(t){if(!this.config.loadNetworkFilters)return;if(!0!==t.isSupported||!1===t.isMainFrame())return;const s=this.csp.matchAll(t,this.isFilterExcluded.bind(this));if(0===s.length)return;const i=new Map,r=[];for(const o of s)if(o.isException()){if(void 0===o.csp)return void this.emit("filter-matched",{exception:o},{request:t,filterType:e.FilterType.NETWORK});i.set(o.csp,o)}else r.push(o);if(0===r.length)return;const o=new Set;for(const s of r.values()){const r=i.get(s.csp);void 0===r&&o.add(s.csp),this.emit("filter-matched",{filter:s,exception:r},{request:t,filterType:e.FilterType.NETWORK})}const n=Array.from(o).join("; ");return n.length>0&&this.emit("csp-injected",t,n),n}match(s,i=!1){var r;const o={exception:void 0,filter:void 0,match:!1,redirect:void 0,rewrite:void 0,metadata:void 0};if(!this.config.loadNetworkFilters)return o;if(s.isSupported){let i,n;if(o.filter=this.importants.match(s,this.isFilterExcluded.bind(this)),void 0===o.filter){const a=this.redirects.matchAll(s,this.isFilterExcluded.bind(this)).sort(((e,t)=>t.getRedirectPriority()-e.getRedirectPriority()));if(0!==a.length)for(const e of a)"none"===e.getRedirectResource()?i=e:e.isRedirectRule()?void 0===n&&(n=e):void 0===o.filter&&(o.filter=e);if(void 0===o.filter&&(o.filter=this.filters.match(s,this.isFilterExcluded.bind(this)),void 0!==n&&void 0!==o.filter&&(o.filter=n)),void 0!==o.filter&&(o.exception=this.exceptions.match(s,this.isFilterExcluded.bind(this))),void 0===o.filter){const i=s.url.indexOf("?");if(-1!==i&&i!==s.url.length-1){const n=s.url.slice(i),a=new t.URLSearchParams(n);let c=!1;const l=new Map,h=new Map;for(const e of this.removeparams.matchAll(s,this.isFilterExcluded.bind(this)))e.isException()?h.set(e.removeparam,e):l.set(e.removeparam,e);const d=(void 0===o.filter?this.exceptions.match(s,this.isFilterExcluded.bind(this)):o.exception)||h.get("");for(const[t,i]of l){if(""===t){if(void 0===d){for(const e of Array.from(a.keys()))a.delete(e);c=!0}this.emit("filter-matched",{filter:i,exception:d},{request:s,filterType:e.FilterType.NETWORK});break}if(!t.startsWith("~")&&n.slice(1,t.length+1)!==t&&!n.includes(`&${t}`))continue;const o=null!==(r=h.get(t))&&void 0!==r?r:d;if(void 0===o)if(t.startsWith("~")){const e=t.slice(1);for(const t of Array.from(a.keys()))t===e||h.has(t)||(a.delete(t),c=!0)}else a.delete(t),c=!0;this.emit("filter-matched",{filter:i,exception:o},{request:s,filterType:e.FilterType.NETWORK})}if(c){let e=s.url.slice(0,i);a.size>0&&(e+="?"+a.toString()),o.rewrite={url:e}}}}}void 0!==o.filter&&void 0===o.exception&&o.filter.isRedirect()&&(void 0!==i?o.exception=i:o.redirect=this.resources.getResource(o.filter.getRedirectResource()))}return o.match=void 0===o.exception&&void 0!==o.filter,o.filter&&this.emit("filter-matched",{filter:o.filter,exception:o.exception},{request:s,filterType:e.FilterType.NETWORK}),void 0!==o.exception?this.emit("request-whitelisted",s,o):void 0!==o.redirect?this.emit("request-redirected",s,o):void 0!==o.filter?this.emit("request-blocked",s,o):this.emit("request-allowed",s,o),!0===i&&void 0!==o.filter&&this.metadata&&(o.metadata=this.metadata.fromFilter(o.filter)),o}getPatternMetadata(e,{getDomainMetadata:t=!1}={}){if(void 0===this.metadata)return[];const s=new Set,i=[];for(const t of this.matchAll(e))for(const e of this.metadata.fromFilter(t))s.has(e.pattern.key)||(s.add(e.pattern.key),i.push(e));if(t)for(const t of this.metadata.fromDomain(e.hostname))s.has(t.pattern.key)||(s.add(t.pattern.key),i.push(t));return i}blockScripts(){return this.updateFromDiff({added:[qe().scripts().redirectTo("javascript").toString()]}),this}blockImages(){return this.updateFromDiff({added:[qe().images().redirectTo("png").toString()]}),this}blockMedias(){return this.updateFromDiff({added:[qe().medias().redirectTo("mp4").toString()]}),this}blockFrames(){return this.updateFromDiff({added:[qe().frames().redirectTo("html").toString()]}),this}blockFonts(){return this.updateFromDiff({added:[qe().fonts().toString()]}),this}blockStyles(){return this.updateFromDiff({added:[qe().styles().toString()]}),this}},e.NetworkFilter=ct,e.Preprocessor=vt,e.Request=pe,e.Resources=At,e.ReverseIndex=Nt,e.StreamingHtmlFilter=class{constructor(e){this.buffer="";const t=[],s=[];for(const i of e)"replace"===i[0]?t.push(i[1]):"script"===i[0]&&s.push(i);this.patterns=function(e){const t=[];for(const[s,i]of e){if("script"!==s)continue;const e=[],r=[];for(const t of i)47===t.charCodeAt(0)?t.endsWith("/")?r.push(new RegExp(t.slice(1,-1))):t.endsWith("/i")&&r.push(new RegExp(t.slice(1,-2),"i")):e.push(t);0===e.length&&0===r.length||t.push([e,r])}return t}(s),this.modifiers=t}flush(e=!0){let t=this.buffer;if(!0===e&&0!==this.modifiers.length){if(0!==this.patterns.length){const[e,s,i]=Ie(this.buffer,"script");t=Re(s,Ce(this.patterns,e))+i}t=function(e,t){if(0===t.length)return e;for(const[s,i]of t)e=e.replace(s,i);return e}(t,this.modifiers)}return this.buffer="",t}write(e){if(0===e.length)return e;if(0!==this.modifiers.length)return this.buffer+=e,"";if(0===this.patterns.length)return e;this.buffer+=e;const[t,s,i]=Ie(this.buffer,"script");return this.buffer=i,0===t.length?s:Re(s,Ce(this.patterns,t))}},e.adsAndTrackingLists=D,e.adsLists=B,e.detectFilterType=xt,e.f=function(e){return kt(e[0])},e.fetchLists=M,e.fetchResources=_,e.fetchWithRetry=j,e.fullLists=N,e.generateDiff=function(e,t,s=new R){const i=new R(Object.assign({},s,{debug:!0})),r=Ft(e,i),o=new Set(r.filters.map((e=>e.getId()))),n=Ft(t,i),a=new Set(n.filters.map((e=>e.getId()))),c=new Set;for(const e of n.filters)o.has(e.getId())||c.add(e.rawLine);const l=new Set;for(const e of r.filters)a.has(e.getId())||l.add(e.rawLine);if(!s.loadPreprocessors)return{added:Array.from(c),removed:Array.from(l),preprocessors:{}};const h=new Map;for(const e of n.filters)h.set(e.getId(),e.rawLine);for(const e of r.filters)h.set(e.getId(),e.rawLine);const d={};for(const e of r.preprocessors){const t=n.preprocessors.find((t=>t.condition===e.condition));if(!t){const t=new Set;for(const s of e.filterIDs)t.add(h.get(s));d[e.condition]={added:[],removed:Array.from(t)};continue}const s={added:new Set,removed:new Set};for(const i of e.filterIDs)t.filterIDs.has(i)||s.removed.add(h.get(i));for(const i of t.filterIDs)e.filterIDs.has(i)||s.added.add(h.get(i));d[e.condition]={added:Array.from(s.added),removed:Array.from(s.removed)}}for(const e of n.preprocessors)if(!d[e.condition]){const t=new Set;for(const s of e.filterIDs)t.add(h.get(s));d[e.condition]={added:Array.from(t),removed:[]}}for(const[e,{added:t,removed:s}]of Object.entries(d))0===t.length&&0===s.length&&delete d[e];return{added:Array.from(c),removed:Array.from(l),preprocessors:d}},e.getHostnameHashesFromLabelsBackward=fe,e.getLinesWithFilters=function(e,t=new R){return new Set(Ft(e,new R(Object.assign({},t,{debug:!0}))).filters.map((({rawLine:e})=>e)))},e.hasUnicode=ae,e.isUTF8=function(e){if(0===e.length)return!0;if(!0===function(e){if(0===e.length)return!0;for(let t=0;t<e.length;t+=1)if(e[t]>127)return!1;return!0}(e))return!0;let t=0;for(let s=0;s<e.length;s+=1){const i=bs[e[s]];if(t=bs[256+16*t+i],1===t||void 0===t)return!1}return!0},e.makeRequest=function(e){return pe.fromRawDetails(e)},e.mergeDiffs=function(e){const t=new Set,s=new Set,i={};for(const{added:r,removed:o,preprocessors:n}of e){if(void 0!==r)for(const e of r)s.has(e)&&s.delete(e),t.add(e);if(void 0!==o)for(const e of o)t.has(e)&&t.delete(e),s.add(e);if(n)for(const[e,t]of Object.entries(n))if(i[e]){if(void 0!==t.added)for(const s of t.added)i[e].removed.has(s)&&i[e].removed.delete(s),i[e].added.add(s);if(void 0!==t.removed)for(const s of t.removed)i[e].added.has(s)&&i[e].added.delete(s),i[e].removed.add(s)}else i[e]={added:void 0!==t.added?new Set(t.added):new Set,removed:void 0!==t.removed?new Set(t.removed):new Set}}return{added:Array.from(t),removed:Array.from(s),preprocessors:Object.fromEntries(Object.entries(i).map((([e,t])=>[e,{added:Array.from(t.added),removed:Array.from(t.removed)}])))}},e.parseFilter=kt,e.parseFilters=St,e.tokenize=re}));
//# sourceMappingURL=adblocker.umd.min.js.map
